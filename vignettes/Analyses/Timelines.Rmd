---
title: "Bachelorarbeit: Timelines"
author: "Patrick Bigler"
date: "2023-07-07"
output:
  html_document:
    toc: yes
    toc_float: yes
    number_sections: yes
  '': default
editor_options:
  markdown:
    wrap: 75
---

+----------------+--------------------------------------------------------+
| **Project:**   | **Bachelor thesis**                                    |
+================+========================================================+
| **Title:**     | **Extracting Signals of Volcanic Events from           |
|                | Transmission data measured by**                        |
|                |                                                        |
|                | **the Smithsonian Institution between 1902 and 1930**  |
+----------------+--------------------------------------------------------+
| **Author:**    | **Patrick Bigler                                       |
|                | (patrick.bigler1\@stundents.unibe.ch**                 |
+----------------+--------------------------------------------------------+
| *              | **Prof. Dr. Stefan Brönnimann                          |
| *Supervisor:** | (stefan.brönnimann\@unibe.ch)**                        |
+----------------+--------------------------------------------------------+
| **             | **University of Bern, Institute of Geography, Unit     |
| Institution:** | Climatology**                                          |
+----------------+--------------------------------------------------------+

# Introduction

## Read packages

We read our R-script with all the packages we need.

```{r Package, message=FALSE, error=FALSE, warning=FALSE}
source("../../R/General/packages.R")

conflicts_prefer(ggplot2::annotate)
conflicts_prefer(dplyr::mutate)
conflicts_prefer(lubridate::stamp)
conflicts_prefer(recipes::fixed)
conflicts_prefer(yardstick::rmse)
conflicts_prefer(ggplot2::vars)
```

# Northern Hemisphere

## Read the data

```{r read_trans_data, message=FALSE, error=FALSE, warning=FALSE}
Washington.annual <- read_csv('../../data/trans_Timeline/Washington.ok.csv')

Mt.Wilson.annual <- read_csv('../../data/trans_Timeline/Mt.Wilson.ok.csv')

Hump_Mountain.annual <- read_csv('../../data/trans_Timeline/Hump_Mountain.ok.csv')

Haraqua_Hala.annual <- read_csv('../../data/trans_Timeline/Haraqua_Hala.ok.csv')

Table_Mountain.annual <- read_csv('../../data/trans_Timeline/Table_Mountain.ok.csv')

Washington.annual|>
  dplyr::filter(Date > as.Date("1902-01-01") & Date < as.Date("1903-12-31"))


Mt.Wilson.annual|>
  dplyr::filter(Date > as.Date("1907-01-01") & Date < as.Date("1913-08-31"))


Mt.Wilson.annual|>
  dplyr::filter(Date > as.Date("1912-01-01") & Date < as.Date("1913-12-31"))


Mt.Wilson.annual|>
  dplyr::filter(Date > as.Date("1918-01-01") & Date < as.Date("1919-12-31"))

Haraqua_Hala.annual|>
  dplyr::filter(Date > as.Date("1924-01-01") & Date < as.Date("1925-12-31"))

```

## Transform all data set for Transmisison

```{r transform_trans, message=FALSE, error=FALSE, warning=FALSE}
selections <- c('Date', 'lambda_1', 'trans_1', 'lambda_2', 'trans_2', 'lambda_3',
                'trans_3','lambda_4', 'trans_4', 'lambda_5', 'trans_5', 'lambda_6', 
                'trans_6', 'lambda_7', 'trans_7','lambda_8', 'trans_8', 'lambda_9', 
                'trans_9', 'lambda_10', 'trans_10', 'lambda_11', 'trans_11')
            
Washington.annual <- Washington.annual|>
dplyr::mutate('lambda_1' = 0.35, 'trans_1' = NA)|>  
dplyr::rename(c('lambda_2' = 'lambda1...m.', 'lambda_3' = 'lambda2...m.',
                'lambda_4' = 'lambda3...m.', 'lambda_5' = 'lambda4...m.',
                'lambda_6' = 'lambda5...m.','lambda_7' = 'lambda6...m.',
                'lambda_8' = 'lambda7...m.','lambda_9' = 'lambda8...m.',
                'lambda_10' = 'lambda9...m.','lambda_11' = 'lambda10...m.',
                'trans_2' = 'transmission1....100.', 'trans_3' = 'transmission2....100.',
                'trans_4' = 'transmission3....100.','trans_5' = 'transmission4....100.',
                'trans_6' = 'transmission5....100.','trans_7' = 'transmission6....100.',
                'trans_8' = 'transmission7....100.','trans_9' = 'transmission8....100.',
                'trans_10' = 'transmission9....100.',
                'trans_11' = 'transmission10....100.'))|>
  dplyr::mutate(Date = lubridate::floor_date(Date, 'year'))|>
  dplyr::select(selections) |>
  dplyr::mutate(across(2:23, ~ifelse(.x > 2, NA, .x)))
  
Washington.annual.long <- Washington.annual  |>
  pivot_longer(cols = starts_with('t'),
               names_to = 'variable',
               values_to = 'values') |>
  dplyr::mutate(variable = factor(variable,
                levels = c("trans_1", "trans_2", "trans_3", "trans_4", 
                           "trans_5", "trans_6", "trans_7", "trans_8",
                           "trans_9", "trans_10", "trans_11")))|> 
  dplyr::mutate(values = ifelse(values >= 2, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values)) |>
  group_by(variable, Date)|>
  summarise_at(vars(values), funs(mean(., na.rm = TRUE))) |>
  dplyr::mutate(values = ifelse(values >= 1, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values))


Mt.Wilson.annual <- Mt.Wilson.annual|>
dplyr::rename(c('lambda_1' = 'lambda_350', 'lambda_2' = 'lambda_400', 
                'lambda_3' = 'lambda_450','lambda_4' = 'lambda_500', 
                'lambda_5' = 'lambda_600','lambda_6' = 'lambda_700',
                'lambda_7' = 'lambda_800','lambda_8' = 'lambda_900',
                'lambda_9' = 'lambda_1000','lambda_10' = 'lambda_1200',
                'lambda_11' = 'lambda_1600','trans_1' = 'trans_350', 
                'trans_2' = 'trans_400', 'trans_3' = 'trans_450',
                'trans_4' = 'trans_500','trans_5' = 'trans_600',
                'trans_6' = 'trans_700','trans_7' = 'trans_800',
                'trans_8' = 'trans_900','trans_9' = 'trans_1000',
                'trans_10' = 'trans_1200','trans_11' = 'trans_1600'))|>
  dplyr::mutate(Date = lubridate::floor_date(Date, 'year'))|>  
  dplyr::select(selections) |>
  dplyr::mutate(across(2:23, ~ifelse(.x > 2, NA, .x)))
  
Mt.Wilson.annual.long <- Mt.Wilson.annual|>  
  pivot_longer(cols = starts_with('t'),
               names_to = 'variable',
               values_to = 'values') |>
  dplyr::mutate(variable = factor(variable,
                levels = c("trans_1", "trans_2", "trans_3", "trans_4", 
                           "trans_5", "trans_6", "trans_7", "trans_8",
                           "trans_9", "trans_10", "trans_11")))|> 
  dplyr::mutate(values = ifelse(values >= 2, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values)) |>  
  group_by(variable, Date)|>
  summarise_at(vars(values), funs(mean(., na.rm = TRUE))) |>
  dplyr::mutate(values = ifelse(values >= 1, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values))


Hump_Mountain.annual <- Hump_Mountain.annual|>
  dplyr::mutate('lambda_9' = 0.9, 'trans_9' = NA)|> 
dplyr::rename(c('lambda_1' = 'lambda1...m.', 'lambda_2' = 'lambda2...m.',
                'lambda_3' = 'lambda3...m.', 'lambda_4' = 'lambda4...m.',
                'lambda_5' = 'lambda5...m.','lambda_6' = 'lambda6...m.',
                'lambda_7' = 'lambda7...m.','lambda_8' = 'lambda8...m.',
                'lambda_10' = 'lambda9...m.','lambda_11' = 'lambda10...m.',
                'trans_1' = 'transmission1....100.', 'trans_2' = 'transmission2....100.',
                'trans_3' = 'transmission3....100.','trans_4' = 'transmission4....100.',
                'trans_5' = 'transmission5....100.','trans_6' = 'transmission6....100.',
                'trans_7' = 'transmission7....100.','trans_8' = 'transmission8....100.',
                'trans_10' = 'transmission9....100.',
                'trans_11' = 'transmission10....100.'))|>
  dplyr::mutate(Date = lubridate::floor_date(Date, 'year'))|>  
  dplyr::select(selections) |>
  dplyr::mutate(across(2:23, ~ifelse(.x > 2, NA, .x)))

Hump_Mountain.annual.long <- Hump_Mountain.annual|>
  pivot_longer(cols = starts_with('t'),
               names_to = 'variable',
               values_to = 'values') |>
  dplyr::mutate(variable = factor(variable,
                levels = c("trans_1", "trans_2", "trans_3", "trans_4", 
                           "trans_5", "trans_6", "trans_7", "trans_8",
                           "trans_9", "trans_10", "trans_11")))|> 
  dplyr::mutate(values = ifelse(values >= 2, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values)) |>    
  group_by(variable, Date)|>
  summarise_at(vars(values), funs(mean(., na.rm = TRUE))) |>
  dplyr::mutate(values = ifelse(values >= 1, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values)) 

Haraqua_Hala.annual <- Haraqua_Hala.annual|>
  dplyr::mutate('lambda_8' = 0.9, 'trans_8' = NA)|> 
dplyr::rename(c('lambda_1' = 'lambda1...m.', 'lambda_2' = 'lambda2...m.',
                'lambda_3' = 'lambda3...m.', 'lambda_4' = 'lambda4...m.',
                'lambda_5' = 'lambda5...m.','lambda_6' = 'lambda6...m.',
                'lambda_7' = 'lambda7...m.','lambda_9' = 'lambda8...m.',
                'lambda_10' = 'lambda9...m.','lambda_11' = 'lambda10...m.',
                'trans_1' = 'transmission1....100.', 'trans_2' = 'transmission2....100.',
                'trans_3' = 'transmission3....100.','trans_4' = 'transmission4....100.',
                'trans_5' = 'transmission5....100.','trans_6' = 'transmission6....100.',
                'trans_7' = 'transmission7....100.','trans_9' = 'transmission8....100.',
                'trans_10' = 'transmission9....100.',
                'trans_11' = 'transmission10....100.'))|>
  dplyr::mutate(Date = lubridate::floor_date(Date, 'year'))|>   
  dplyr::select(selections) |>
  dplyr::mutate(across(2:23, ~ifelse(.x > 2, NA, .x)))

Haraqua_Hala.annual.long <- Haraqua_Hala.annual|>    
  pivot_longer(cols = starts_with('t'),
               names_to = 'variable',
               values_to = 'values') |>
  dplyr::mutate(variable = factor(variable,
                levels = c("trans_1", "trans_2", "trans_3", "trans_4", 
                           "trans_5", "trans_6", "trans_7", "trans_8",
                           "trans_9", "trans_10", "trans_11")))|> 
  dplyr::mutate(values = ifelse(values >= 2, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values)) |>    
  group_by(variable, Date)|>
  summarise_at(vars(values), funs(mean(., na.rm = TRUE))) |>
  dplyr::mutate(values = ifelse(values >= 1, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values)) 

Table_Mountain.annual <- Table_Mountain.annual|>
  dplyr::mutate('lambda_8' = 0.9, 'trans_8' = NA)|> 
dplyr::rename(c('lambda_1' = 'lambda1...m.', 'lambda_2' = 'lambda2...m.',
                'lambda_3' = 'lambda3...m.', 'lambda_4' = 'lambda4...m.',
                'lambda_5' = 'lambda5...m.','lambda_6' = 'lambda6...m.',
                'lambda_7' = 'lambda7...m.','lambda_9' = 'lambda8...m.',
                'lambda_10' = 'lambda9...m.','lambda_11' = 'lambda10...m.',
                'trans_1' = 'transmission1....100.', 'trans_2' = 'transmission2....100.',
                'trans_3' = 'transmission3....100.','trans_4' = 'transmission4....100.',
                'trans_5' = 'transmission5....100.','trans_6' = 'transmission6....100.',
                'trans_7' = 'transmission7....100.','trans_9' = 'transmission8....100.',
                'trans_10' = 'transmission9....100.',
                'trans_11' = 'transmission10....100.'))|>
  dplyr::mutate(Date = lubridate::floor_date(Date, 'year'))|>   
  dplyr::select(selections) |>
  dplyr::mutate(across(2:23, ~ifelse(.x > 2, NA, .x)))

Table_Mountain.annual.long <- Table_Mountain.annual|>
  pivot_longer(cols = starts_with('t'),
               names_to = 'variable',
               values_to = 'values') |>
  dplyr::mutate(variable = factor(variable,
                levels = c("trans_1", "trans_2", "trans_3", "trans_4", 
                           "trans_5", "trans_6", "trans_7", "trans_8",
                           "trans_9", "trans_10", "trans_11")))|> 
  dplyr::mutate(values = ifelse(values >= 2, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values)) |>    
  group_by(variable, Date)|>
  summarise_at(vars(values), funs(mean(., na.rm = TRUE))) |>
  dplyr::mutate(values = ifelse(values >= 1, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values))


```

## Transform all data sets for Optical Depth

```{r}
Washington.annual.long.od <- Washington.annual.long|>
    dplyr::mutate_at(c('values'), ~-log(.))

Mt.Wilson.annual.long.od <- Mt.Wilson.annual.long|>
    dplyr::mutate_at(c('values'), ~-log(.))

Hump_Mountain.annual.long.od <- Hump_Mountain.annual.long|>
    dplyr::mutate_at(c('values'), ~-log(.))

Haraqua_Hala.annual.long.od <- Haraqua_Hala.annual.long|>
    dplyr::mutate_at(c('values'), ~-log(.))

Table_Mountain.annual.long.od <- Table_Mountain.annual.long|>
    dplyr::mutate_at(c('values'), ~-log(.))
```

## Transform all data sets for Ångström Parameter

```{r transform_alpha, message=FALSE, error=FALSE, warning=FALSE}
Washington.annual.alpha <- read_csv('../../data/alpha_timeline/Washington.alpha.csv')

Mt.Wilson.annual.alpha <- read_csv('../../data/alpha_timeline/Mt.Wilson.alpha.csv')

Hump_Mountain.annual.alpha <- read_csv('../../data/alpha_timeline/Hump_Mountain.alpha.csv')

Haraqua_Hala.annual.alpha <- read_csv('../../data/alpha_timeline/Haraqua_Hala.alpha.csv')

Table_Mountain.annual.alpha <- read_csv('../../data/alpha_timeline/Table_Mountain.alpha.csv')
```

## Graphs of the Northern Hemisphere

### Timeline with Transmission

```{r}
conflicts_prefer(data.table::month)

northern.timeline.trans <- ggplot()+
  geom_point(data = Washington.annual.long, aes(x = Date, y = values, color = variable))+
  geom_point(data = Mt.Wilson.annual.long, aes(x = Date, y = values, color = variable)) +
  geom_point(data = Haraqua_Hala.annual.long, aes(x = Date, y = values, color = variable)) +
  geom_point(data = Table_Mountain.annual.long, aes(x = Date, y = values, color = variable)) +
  geom_line(data = Washington.annual.long, aes(x = Date, y = values, color = variable))+
  geom_line(data = Mt.Wilson.annual.long, aes(x = Date, y = values, color = variable)) +
  geom_line(data = Haraqua_Hala.annual.long, aes(x = Date, y = values, color = variable)) +
  geom_line(data = Table_Mountain.annual.long, aes(x = Date, y = values, color = variable)) +  
  geom_rect(aes(xmin = as.Date("1902-10-19", format = '%Y-%m-%d'), 
                xmax = as.Date("1904-04-20", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +
  geom_rect(aes(xmin = as.Date("1908-01-01", format = '%Y-%m-%d'), 
                xmax = as.Date("1909-08-09", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
            color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +   
  geom_rect(aes(xmin = as.Date("1912-06-12", format = '%Y-%m-%d'), 
                xmax = as.Date("1914-06-04", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +
  geom_rect(aes(xmin = as.Date("1918-01-01", format = '%Y-%m-%d'), 
                xmax = as.Date("1920-03-19", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +  
  geom_rect(aes(xmin = as.Date("1924-11-24", format = '%Y-%m-%d'), 
                xmax = as.Date("1925-05-26", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +  
  annotate("text", x = as.Date("1904-04-20", format = '%Y-%m-%d'),
  y = .2, label= "Santa Maria [WDC06A]", hjust = 0, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) +
  annotate("text", x = as.Date("1909-08-09", format = '%Y-%m-%d'),
  y = .2, label= "Ksudach [NEEM-S1]", hjust = 0, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) +  
  annotate("text", x = as.Date("1914-06-04", format = '%Y-%m-%d'),
  y = .2, label= "Novarupta [NEEM-S1]", hjust = 0, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) +  
  annotate("text", x = as.Date("1920-03-19", format = '%Y-%m-%d'),
  y = .2, label= "Katla [NEEM-S1]", hjust = 0, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) + 
  annotate("text", x = as.Date("1925-05-26", format = '%Y-%m-%d'),
  y = .2, label= "Raikoke [NEEM-S1]", hjust = 0, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) +   
  geom_vline(xintercept = as.numeric(as.Date("1902-10-24")), linetype = 'dotted') +
  geom_vline(xintercept = as.numeric(as.Date("1912-06-06")), linetype = 'dotted') +
  geom_vline(xintercept = as.numeric(as.Date("1907-03-28")), linetype = 'dotted') +  
  geom_vline(xintercept = as.numeric(as.Date("1918-10-12")), linetype = 'dotted') + 
  geom_vline(xintercept = as.numeric(as.Date("1924-02-15")), linetype = 'dotted') +  
  annotate("text", x = as.Date("1902-10-24", format = '%Y-%m-%d'),
  y = .2, label= "Santa Maria [1902-10-24]", hjust = 0, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) + 
  annotate("text", x = as.Date("1912-06-06", format = '%Y-%m-%d'),
  y = .2, label= "Novarupta [1912-06-06]", hjust = 0, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) +
  annotate("text", x = as.Date("1907-03-28", format = '%Y-%m-%d'),
  y = .2, label= "Ksudach [1907-03-28]", hjust = 0, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) +  
  annotate("text", x = as.Date("1918-10-12", format = '%Y-%m-%d'),
  y = .2, label= "Katla [1918-10-12]", hjust = 0, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) + 
  annotate("text", x = as.Date("1924-02-15", format = '%Y-%m-%d'),
  y = .2, label= "Raikoke [1924-02-15]", hjust = 0, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) + 
  labs(x = 'Time [year]', y = 'Annual mean of the transmission [ ]') +  
  scale_color_viridis_d(option = "viridis", 
                        guide = guide_legend(override.aes = list(size = 3,alpha = 1),
                        title = "Wavelength [nm]"), 
                        label = c('340 - 360' ,'390 - 410', '440 - 460', '490 - 510', 
                                 '590 - 630', '700 - 725', '790 - 810','890 - 910', 
                                 '990 -1010', '1190 - 1210', '1590 - 1610')) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))+
  theme(text = element_text(size = 20))

northern.timeline.trans 
```

#### Extract Transmission Signal

```{r}
# Make your own filter
mutate <- c("trans_1", "trans_2", "trans_3", "trans_4", "trans_5", "trans_6", "trans_7",
            "trans_8", "trans_9", "trans_10", "trans_11")

# Function
signal.extractor <- function(data1, row_1 = 1, row_2 = 2) {
  new <- NULL
  for(i in 1:ncol(data1)) { 
  new <- c(new, round(((data1[row_2, i] - data1[row_1, i])/data1[row_1, i])*100, digits = 3))
  }
  data1[nrow(data1) + 1,] <- new
  temp.df <- data1|>
    slice(n())|>
    dplyr::rename(c('350 nm' = "trans_1_mean",'400 nm' = "trans_2_mean", 
                    '450 nm' = "trans_3_mean",'500 nm' = "trans_4_mean", 
                    '600 nm' = "trans_5_mean",'700 nm' = "trans_6_mean",
                    '800 nm' = "trans_7_mean",'900 nm' = "trans_8_mean", 
                    '1000 nm' = "trans_9_mean",'1200 nm' = "trans_10_mean",
                    '1600 nm' = "trans_11_mean"))
  return(temp.df)
}

# Washington --> 1902 to 1903 (Santa Maria)
SantaMaria.t <- c('Santa Maria',signal.extractor(Washington.annual|>
    group_by(Date)|>
    summarise_at(vars(mutate), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 1, 2))# |>
    #rowMeans(na.rm = TRUE)

# Mt.Wilson --> 1906 to 1908 (Ksudach)
Ksudach.t <- c('Ksudach',signal.extractor(Mt.Wilson.annual|>
    group_by(Date)|>
    summarise_at(vars(mutate), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 1, 3))# |>
    #rowMeans(na.rm = TRUE)

# Mt.Wilson --> 1911 to 1912 (Novaruptu)
Novarupta.t <- c('Novarupta',signal.extractor(Mt.Wilson.annual|>
    group_by(Date)|>
    summarise_at(vars(mutate), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 6, 7))#|>
    #rowMeans(na.rm = TRUE)
    
# Mt.Wilson --> 1917 to 1918 (Katla)
Katla.t <- c('Katla',signal.extractor(Mt.Wilson.annual|>
    group_by(Date)|>
    summarise_at(vars(mutate), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 12, 13))#|>
    #rowMeans(na.rm = TRUE)

# Haraqua Hala --> 1924 to 1925 ( Raikoke)
Raikoke.t <- c('Raikoke',signal.extractor(Haraqua_Hala.annual|>
    group_by(Date)|>
    summarise_at(vars(mutate), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 5, 6))#|>
    #rowMeans(na.rm = TRUE)

kable(do.call("rbind", list(SantaMaria.t, Ksudach.t, 
                      Novarupta.t, Katla.t, Raikoke.t)),
      align = c('l', rep('c', times = 11)))|>
  kable_classic()
```

#### Statistics

```{r}
Washington.annual.long|>
  group_by(variable) |>
  summarise_at(vars(values), funs(Min = min(., na.rm = TRUE), 
                                  Max = max(., na.rm = TRUE), 
                                  Median = median(., na.rm = TRUE),
                                  Mean = mean(., na.rm = TRUE),
                                  Std = sd(., na.rm = TRUE),
                                  IQR = IQR(.,na.rm = TRUE),
                                  Span = max(., na.rm = TRUE) - min(., na.rm = TRUE),
                                  '0.25.quantile' = quantile(., probs = .25, na.rm = TRUE),
                                  '0.75.quantile' = quantile(., probs = .75, na.rm = TRUE)))

Mt.Wilson.annual.long|>
  group_by(variable) |>
  summarise_at(vars(values), funs(Min = min(., na.rm = TRUE), 
                                  Max = max(., na.rm = TRUE), 
                                  Median = median(., na.rm = TRUE),
                                  Mean = mean(., na.rm = TRUE),
                                  Std = sd(., na.rm = TRUE),
                                  IQR = IQR(.,na.rm = TRUE),
                                  Span = max(., na.rm = TRUE) - min(., na.rm = TRUE),
                                  '0.25.quantile' = quantile(., probs = .25, na.rm = TRUE),
                                  '0.75.quantile' = quantile(., probs = .75, na.rm = TRUE)))

Haraqua_Hala.annual.long|>
  group_by(variable) |>
  summarise_at(vars(values), funs(Min = min(., na.rm = TRUE), 
                                  Max = max(., na.rm = TRUE), 
                                  Median = median(., na.rm = TRUE),
                                  Mean = mean(., na.rm = TRUE),
                                  Std = sd(., na.rm = TRUE),
                                  IQR = IQR(.,na.rm = TRUE),
                                  Span = max(., na.rm = TRUE) - min(., na.rm = TRUE),
                                  '0.25.quantile' = quantile(., probs = .25, na.rm = TRUE),
                                  '0.75.quantile' = quantile(., probs = .75, na.rm = TRUE)))

Table_Mountain.annual.long|>
  group_by(variable) |>
  summarise_at(vars(values), funs(Min = min(., na.rm = TRUE), 
                                  Max = max(., na.rm = TRUE), 
                                  Median = median(., na.rm = TRUE),
                                  Mean = mean(., na.rm = TRUE),
                                  Std = sd(., na.rm = TRUE),
                                  IQR = IQR(.,na.rm = TRUE),
                                  Span = max(., na.rm = TRUE) - min(., na.rm = TRUE),
                                  '0.25.quantile' = quantile(., probs = .25, na.rm = TRUE),
                                  '0.75.quantile' = quantile(., probs = .75, na.rm = TRUE)))
```

### Timeline with Optical Depth

```{r}
conflicts_prefer(data.table::month)

northern.timeline.od <- ggplot()+
  geom_point(data = Washington.annual.long.od, aes(x = Date, y = values, color = variable))+
  geom_point(data = Mt.Wilson.annual.long.od, aes(x = Date, y = values, color = variable)) +
  geom_point(data = Haraqua_Hala.annual.long.od, aes(x = Date, y = values, color = variable)) +
  geom_point(data = Table_Mountain.annual.long.od,aes(x = Date, y = values, color = variable)) +
  geom_line(data = Washington.annual.long.od, aes(x = Date, y = values, color = variable))+
  geom_line(data = Mt.Wilson.annual.long.od, aes(x = Date, y = values, color = variable)) +
  geom_line(data = Haraqua_Hala.annual.long.od, aes(x = Date, y = values, color = variable)) +
  geom_line(data = Table_Mountain.annual.long.od, aes(x = Date,y = values, color = variable)) + 
  geom_rect(aes(xmin = as.Date("1902-10-19", format = '%Y-%m-%d'), 
                xmax = as.Date("1904-04-20", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +
  geom_rect(aes(xmin = as.Date("1908-01-01", format = '%Y-%m-%d'), 
                xmax = as.Date("1909-08-09", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
            color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +   
  geom_rect(aes(xmin = as.Date("1912-06-12", format = '%Y-%m-%d'), 
                xmax = as.Date("1914-06-04", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +
  geom_rect(aes(xmin = as.Date("1918-01-01", format = '%Y-%m-%d'), 
                xmax = as.Date("1920-03-19", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +  
  geom_rect(aes(xmin = as.Date("1924-11-24", format = '%Y-%m-%d'), 
                xmax = as.Date("1925-05-26", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +  
  annotate("text", x = as.Date("1904-04-20", format = '%Y-%m-%d'),
  y = 1.2, label= "Santa Maria [WDC06A]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) +
  annotate("text", x = as.Date("1909-08-09", format = '%Y-%m-%d'),
  y = 1.2, label= "Ksudach [NEEM-S1]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) +  
  annotate("text", x = as.Date("1914-06-04", format = '%Y-%m-%d'),
  y = 1.2, label= "Novarupta [NEEM-S1]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) +  
  annotate("text", x = as.Date("1920-03-19", format = '%Y-%m-%d'),
  y = 1.2, label= "Katla [NEEM-S1]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) + 
  annotate("text", x = as.Date("1925-05-26", format = '%Y-%m-%d'),
  y = 1.2, label= "Raikoke [NEEM-S1]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) +   
  geom_vline(xintercept = as.numeric(as.Date("1902-10-24")), linetype = 'dotted') +
  geom_vline(xintercept = as.numeric(as.Date("1912-06-06")), linetype = 'dotted') +
  geom_vline(xintercept = as.numeric(as.Date("1907-03-28")), linetype = 'dotted') +  
  geom_vline(xintercept = as.numeric(as.Date("1918-10-12")), linetype = 'dotted') + 
  geom_vline(xintercept = as.numeric(as.Date("1924-02-15")), linetype = 'dotted') +  
  annotate("text", x = as.Date("1902-10-24", format = '%Y-%m-%d'),
  y = 1.2, label= "Santa Maria [1902-10-24]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) + 
  annotate("text", x = as.Date("1912-06-06", format = '%Y-%m-%d'),
  y = 1.2, label= "Novarupta [1912-06-06]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) +
  annotate("text", x = as.Date("1907-03-28", format = '%Y-%m-%d'),
  y = 1.2, label= "Ksudach [1907-03-28]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) +  
  annotate("text", x = as.Date("1918-10-12", format = '%Y-%m-%d'),
  y = 1.2, label= "Katla [1918-10-12]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) + 
  annotate("text", x = as.Date("1924-02-15", format = '%Y-%m-%d'),
  y = 1.2, label= "Raikoke [1924-02-15]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) + 
  labs(x = 'Time [year]', y = 'Annual mean of the optical depth [ ]') +  
  scale_color_viridis_d(option = "viridis", 
                        guide = guide_legend(override.aes = list(size = 3,alpha = 1),
                        title = "Wavelength [nm]"), 
                        label = c('340 - 360' ,'390 - 410', '440 - 460', '490 - 510', 
                                 '595 - 625', '700 - 725', '790 - 810','890 - 910', 
                                 '990 -1010', '1190 - 1210', '1590 - 1610')) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1)) +
  theme(text = element_text(size = 20))  

northern.timeline.od
```

#### Extract Optical Depth Signal

```{r transform_od, message=FALSE, error=FALSE, warning=FALSE}
# Washington --> 1902 to 1903 (Santa Maria)
SantaMaria.od <- c('Santa Maria',signal.extractor(Washington.annual|>
    dplyr::mutate_at(mutate , ~-log(.)) |>
    group_by(Date)|>
    summarise_at(vars(mutate), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 1, 2))# |>
    #mean_row(na.rm = TRUE)

# Mt.Wilson --> 1906 to 1908 (Ksudach)
Ksudach.od <- c('Ksudach',signal.extractor(Mt.Wilson.annual|>
    dplyr::mutate_at(mutate , ~-log(.))|>
    group_by(Date)|>
    summarise_at(vars(mutate), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 1, 3))# |>
    #mean_row(na.rm = TRUE)

# Mt.Wilson --> 1911 to 1912 (Novaruptu)
Novarupta.od <- c('Novarupta',signal.extractor(Mt.Wilson.annual|>
    dplyr::mutate_at(mutate , ~-log(.))|>
    group_by(Date)|>
    summarise_at(vars(mutate), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 6, 7))#|>
    #mean_row(na.rm = TRUE)
    
# Mt.Wilson --> 1917 to 1918 (Katla)
Katla.od <- c('Katla',signal.extractor(Mt.Wilson.annual|>
    dplyr::mutate_at(mutate , ~-log(.))|>
    group_by(Date)|>
    summarise_at(vars(mutate), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 12, 13))#|>
    #mean_row(na.rm = TRUE)

# Haraqua Hala --> 1924 to 1925 ( Raikoke)
Raikoke.od <- c('Raikoke',signal.extractor(Haraqua_Hala.annual|>
    dplyr::mutate_at(mutate , ~-log(.))|>
    group_by(Date)|>
    summarise_at(vars(mutate), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 5, 6))#|>
    #mean_row(na.rm = TRUE)

kable(do.call("rbind", list(SantaMaria.od, Ksudach.od, 
                      Novarupta.od, Katla.od, Raikoke.od)),
      align = c('l', rep('c', times = 11)))|>
  kable_classic()
```

#### Statistics

```{r}
Washington.annual.long.od|>
  group_by(variable) |>
  summarise_at(vars(values), funs(Min = min(., na.rm = TRUE), 
                                  Max = max(., na.rm = TRUE), 
                                  Median = median(., na.rm = TRUE),
                                  Mean = mean(., na.rm = TRUE),
                                  Std = sd(., na.rm = TRUE),
                                  IQR = IQR(.,na.rm = TRUE),
                                  Span = max(., na.rm = TRUE) - min(., na.rm = TRUE),
                                  '0.25.quantile' = quantile(., probs = .25, na.rm = TRUE),
                                  '0.75.quantile' = quantile(., probs = .75, na.rm = TRUE)))

Mt.Wilson.annual.long.od|>
  group_by(variable) |>
  summarise_at(vars(values), funs(Min = min(., na.rm = TRUE), 
                                  Max = max(., na.rm = TRUE), 
                                  Median = median(., na.rm = TRUE),
                                  Mean = mean(., na.rm = TRUE),
                                  Std = sd(., na.rm = TRUE),
                                  IQR = IQR(.,na.rm = TRUE),
                                  Span = max(., na.rm = TRUE) - min(., na.rm = TRUE),
                                  '0.25.quantile' = quantile(., probs = .25, na.rm = TRUE),
                                  '0.75.quantile' = quantile(., probs = .75, na.rm = TRUE)))

Haraqua_Hala.annual.long.od|>
  group_by(variable) |>
  summarise_at(vars(values), funs(Min = min(., na.rm = TRUE), 
                                  Max = max(., na.rm = TRUE), 
                                  Median = median(., na.rm = TRUE),
                                  Mean = mean(., na.rm = TRUE),
                                  Std = sd(., na.rm = TRUE),
                                  IQR = IQR(.,na.rm = TRUE),
                                  Span = max(., na.rm = TRUE) - min(., na.rm = TRUE),
                                  '0.25.quantile' = quantile(., probs = .25, na.rm = TRUE),
                                  '0.75.quantile' = quantile(., probs = .75, na.rm = TRUE)))

Table_Mountain.annual.long.od|>
  group_by(variable) |>
  summarise_at(vars(values), funs(Min = min(., na.rm = TRUE), 
                                  Max = max(., na.rm = TRUE), 
                                  Median = median(., na.rm = TRUE),
                                  Mean = mean(., na.rm = TRUE),
                                  Std = sd(., na.rm = TRUE),
                                  IQR = IQR(.,na.rm = TRUE),
                                  Span = max(., na.rm = TRUE) - min(., na.rm = TRUE),
                                  '0.25.quantile' = quantile(., probs = .25, na.rm = TRUE),
                                  '0.75.quantile' = quantile(., probs = .75, na.rm = TRUE)))
```

### Timeline with Ångström Parameter

```{r}
conflicts_prefer(data.table::month)

northern.timeline.alpha <- ggplot()+
  geom_point(data = Washington.annual.alpha, aes(x = month, y = values, color = variable))+
  geom_point(data = Mt.Wilson.annual.alpha, aes(x = month, y = values, color = variable)) +
  geom_point(data = Haraqua_Hala.annual.alpha, aes(x = month, y = values, color = variable)) +
  geom_point(data = Table_Mountain.annual.alpha, aes(x = month, y = values, color = variable)) +
  geom_line(data = Washington.annual.alpha, aes(x = month, y = values, color = variable))+
  geom_line(data = Mt.Wilson.annual.alpha, aes(x = month, y = values, color = variable)) +
  geom_line(data = Haraqua_Hala.annual.alpha, aes(x = month, y = values, color = variable)) +
  geom_line(data = Table_Mountain.annual.alpha, aes(x = month, y = values, color = variable)) + 
  geom_rect(aes(xmin = as.Date("1902-10-19", format = '%Y-%m-%d'), 
                xmax = as.Date("1904-04-20", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +
  geom_rect(aes(xmin = as.Date("1908-01-01", format = '%Y-%m-%d'), 
                xmax = as.Date("1909-08-09", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
            color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +   
  geom_rect(aes(xmin = as.Date("1912-06-12", format = '%Y-%m-%d'), 
                xmax = as.Date("1914-06-04", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +
  geom_rect(aes(xmin = as.Date("1918-01-01", format = '%Y-%m-%d'), 
                xmax = as.Date("1920-03-19", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +  
  geom_rect(aes(xmin = as.Date("1924-11-24", format = '%Y-%m-%d'), 
                xmax = as.Date("1925-05-26", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +  
  annotate("text", x = as.Date("1904-04-20", format = '%Y-%m-%d'),
  y = .2, label= "Santa Maria [WDC06A]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5) +
  annotate("text", x = as.Date("1909-08-09", format = '%Y-%m-%d'),
  y = .2, label= "Ksudach [NEEM-S1]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5) +  
  annotate("text", x = as.Date("1914-06-04", format = '%Y-%m-%d'),
  y = .2, label= "Novarupta [NEEM-S1]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5) +  
  annotate("text", x = as.Date("1920-03-19", format = '%Y-%m-%d'),
  y = .2, label= "Katla [NEEM-S1]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5) + 
  annotate("text", x = as.Date("1925-05-26", format = '%Y-%m-%d'),
  y = .2, label= "Raikoke [NEEM-S1]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5) +   
  geom_vline(xintercept = as.numeric(as.Date("1902-10-24")), linetype = 'dotted') +
  geom_vline(xintercept = as.numeric(as.Date("1912-06-06")), linetype = 'dotted') +
  geom_vline(xintercept = as.numeric(as.Date("1907-03-28")), linetype = 'dotted') +  
  geom_vline(xintercept = as.numeric(as.Date("1918-10-12")), linetype = 'dotted') + 
  geom_vline(xintercept = as.numeric(as.Date("1924-02-15")), linetype = 'dotted') +  
  annotate("text", x = as.Date("1902-10-24", format = '%Y-%m-%d'),
  y = .2, label= "Santa Maria [1902-10-24]", hjust = 1,vjust = -0.2, angle =90, alpha =0.5) + 
  annotate("text", x = as.Date("1912-06-06", format = '%Y-%m-%d'),
  y = .2, label= "Novarupta [1912-06-06]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5) +
  annotate("text", x = as.Date("1907-03-28", format = '%Y-%m-%d'),
  y = .2, label= "Ksudach [1907-03-28]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5) +  
  annotate("text", x = as.Date("1918-10-12", format = '%Y-%m-%d'),
  y = .2, label= "Katla [1918-10-12]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5) + 
  annotate("text", x = as.Date("1924-02-15", format = '%Y-%m-%d'),
  y = .2, label= "Raikoke [1924-02-15]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5) + 
  labs(x = 'Time [year]', y = 'Annual mean of the Ångström Parameter [ ]') +  
  scale_y_continuous(limits = c(-0.05,0.2)) +
  scale_color_viridis_d(option = "viridis", 
                        guide = guide_legend(override.aes = list(size = 3,alpha = 1),
                        title = "Wavelength [nm]"), 
                        label = c('340 - 360' ,'390 - 410', '440 - 460', '490 - 510', 
                                 '590 - 610', '700 - 725', '790 - 810','890 - 910', 
                                 '1190 - 1210', '1590 - 1610')) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))

northern.timeline.alpha
```

#### Extract Ångström Signal

```{r}

# Make your own filter
mutate.alpha <- c("alpha_350", "alpha_400", "alpha_450", "alpha_500", "alpha_600", "alpha_700",
                  "alpha_800","alpha_900", "alpha_1200", "alpha_1600")

# Function
signal.extractor.alpha <- function(data1, row_1 = 1, row_2 = 2) {
  new <- NULL
  for(i in 1:ncol(data1)) { 
  new <- c(new, round(((data1[row_2, i] - data1[row_1, i])/data1[row_1, i])*100, digits = 3))
  }
  data1[nrow(data1) + 1,] <- new
  temp.df <- data1|>
    slice(n())|>
    dplyr::rename(c('350 nm' = "alpha_350_mean",'400 nm' = "alpha_400_mean", 
                    '450 nm' = "alpha_450_mean",'500 nm' = "alpha_500_mean", 
                    '600 nm' = "alpha_600_mean",'700 nm' = "alpha_700_mean",
                    '800 nm' = "alpha_800_mean",'900 nm' = "alpha_900_mean", 
                    '1200 nm' = "alpha_1200_mean",'1600 nm' = "alpha_1600_mean"))
  return(temp.df)
}

# Washington --> 1902 to 1903 (Santa Maria)
SantaMaria.a <- c('Santa Maria',signal.extractor.alpha(Washington.annual|>
  dplyr::mutate(
    alpha_350=-(log(Washington.annual$trans_1)-log(Washington.annual$trans_9))/log(350),
    alpha_400=-(log(Washington.annual$trans_2)-log(Washington.annual$trans_9))/log(400),
    alpha_450=-(log(Washington.annual$trans_3)-log(Washington.annual$trans_9))/log(450),
    alpha_500=-(log(Washington.annual$trans_4)-log(Washington.annual$trans_9))/log(500),
    alpha_600=-(log(Washington.annual$trans_5)-log(Washington.annual$trans_9))/log(600),
    alpha_700=-(log(Washington.annual$trans_6)-log(Washington.annual$trans_9))/log(700),
    alpha_800=-(log(Washington.annual$trans_7)-log(Washington.annual$trans_9))/log(800),
    alpha_900=-(log(Washington.annual$trans_8)-log(Washington.annual$trans_9))/log(900),
    alpha_1200=-(log(Washington.annual$trans_10)-log(Washington.annual$trans_9))/log(1200),
    alpha_1600=-(log(Washington.annual$trans_11)-log(Washington.annual$trans_9))/log(1600))|>
    dplyr::select(c('Date', starts_with('a'))) |>
    group_by(Date)|>
    summarise_at(vars(mutate.alpha), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 1, 2))# |>
    #rowMeans(na.rm = TRUE)

# Mt.Wilson --> 1906 to 1908 (Ksudach)
Ksudach.a <- c('Ksudach',signal.extractor.alpha(Mt.Wilson.annual|>
  dplyr::mutate(
    alpha_350=-(log(Mt.Wilson.annual$trans_1)-log(Mt.Wilson.annual$trans_9))/log(350),
    alpha_400=-(log(Mt.Wilson.annual$trans_2)-log(Mt.Wilson.annual$trans_9))/log(400),
    alpha_450=-(log(Mt.Wilson.annual$trans_3)-log(Mt.Wilson.annual$trans_9))/log(450),
    alpha_500=-(log(Mt.Wilson.annual$trans_4)-log(Mt.Wilson.annual$trans_9))/log(500),
    alpha_600=-(log(Mt.Wilson.annual$trans_5)-log(Mt.Wilson.annual$trans_9))/log(600),
    alpha_700=-(log(Mt.Wilson.annual$trans_6)-log(Mt.Wilson.annual$trans_9))/log(700),
    alpha_800=-(log(Mt.Wilson.annual$trans_7)-log(Mt.Wilson.annual$trans_9))/log(800),
    alpha_900=-(log(Mt.Wilson.annual$trans_8)-log(Mt.Wilson.annual$trans_9))/log(900),
    alpha_1200=-(log(Mt.Wilson.annual$trans_10)-log(Mt.Wilson.annual$trans_9))/log(1200),
    alpha_1600=-(log(Mt.Wilson.annual$trans_11)-log(Mt.Wilson.annual$trans_9))/log(1600))|>
    dplyr::select(c('Date', starts_with('a'))) |>
    group_by(Date)|>
    summarise_at(vars(mutate.alpha), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 1, 3))# |>
    #rowMeans(na.rm = TRUE)

# Mt.Wilson --> 1911 to 1912 (Novaruptu)
Novarupta.a <- c('Novarupta',signal.extractor.alpha(Mt.Wilson.annual|>
  dplyr::mutate(
    alpha_350=-(log(Mt.Wilson.annual$trans_1)-log(Mt.Wilson.annual$trans_9))/log(350),
    alpha_400=-(log(Mt.Wilson.annual$trans_2)-log(Mt.Wilson.annual$trans_9))/log(400),
    alpha_450=-(log(Mt.Wilson.annual$trans_3)-log(Mt.Wilson.annual$trans_9))/log(450),
    alpha_500=-(log(Mt.Wilson.annual$trans_4)-log(Mt.Wilson.annual$trans_9))/log(500),
    alpha_600=-(log(Mt.Wilson.annual$trans_5)-log(Mt.Wilson.annual$trans_9))/log(600),
    alpha_700=-(log(Mt.Wilson.annual$trans_6)-log(Mt.Wilson.annual$trans_9))/log(700),
    alpha_800=-(log(Mt.Wilson.annual$trans_7)-log(Mt.Wilson.annual$trans_9))/log(800),
    alpha_900=-(log(Mt.Wilson.annual$trans_8)-log(Mt.Wilson.annual$trans_9))/log(900),
    alpha_1200=-(log(Mt.Wilson.annual$trans_10)-log(Mt.Wilson.annual$trans_9))/log(1200),
    alpha_1600=-(log(Mt.Wilson.annual$trans_11)-log(Mt.Wilson.annual$trans_9))/log(1600))|>
    dplyr::select(c('Date', starts_with('a'))) |>
    group_by(Date)|>
    summarise_at(vars(mutate.alpha), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 6, 7))# |>
    #rowMeans(na.rm = TRUE)

# Mt.Wilson --> 1917 to 1918 (Katla)
Katla.a <- c('Katla',signal.extractor.alpha(Mt.Wilson.annual|>
  dplyr::mutate(
    alpha_350=-(log(Mt.Wilson.annual$trans_1)-log(Mt.Wilson.annual$trans_9))/log(350),
    alpha_400=-(log(Mt.Wilson.annual$trans_2)-log(Mt.Wilson.annual$trans_9))/log(400),
    alpha_450=-(log(Mt.Wilson.annual$trans_3)-log(Mt.Wilson.annual$trans_9))/log(450),
    alpha_500=-(log(Mt.Wilson.annual$trans_4)-log(Mt.Wilson.annual$trans_9))/log(500),
    alpha_600=-(log(Mt.Wilson.annual$trans_5)-log(Mt.Wilson.annual$trans_9))/log(600),
    alpha_700=-(log(Mt.Wilson.annual$trans_6)-log(Mt.Wilson.annual$trans_9))/log(700),
    alpha_800=-(log(Mt.Wilson.annual$trans_7)-log(Mt.Wilson.annual$trans_9))/log(800),
    alpha_900=-(log(Mt.Wilson.annual$trans_8)-log(Mt.Wilson.annual$trans_9))/log(900),
    alpha_1200=-(log(Mt.Wilson.annual$trans_10)-log(Mt.Wilson.annual$trans_9))/log(1200),
    alpha_1600=-(log(Mt.Wilson.annual$trans_11)-log(Mt.Wilson.annual$trans_9))/log(1600))|>
    dplyr::select(c('Date', starts_with('a'))) |>
    group_by(Date)|>
    summarise_at(vars(mutate.alpha), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 12, 13))# |>
    #rowMeans(na.rm = TRUE)

# Haraqua Hala --> 1924 to 1925 ( Raikoke)
Raikoke.a <- c('Raikoke',signal.extractor.alpha(Haraqua_Hala.annual|>
  dplyr::mutate(
    alpha_350=-(log(Haraqua_Hala.annual$trans_1)-log(Haraqua_Hala.annual$trans_9))/log(350),
    alpha_400=-(log(Haraqua_Hala.annual$trans_2)-log(Haraqua_Hala.annual$trans_9))/log(400),
    alpha_450=-(log(Haraqua_Hala.annual$trans_3)-log(Haraqua_Hala.annual$trans_9))/log(450),
    alpha_500=-(log(Haraqua_Hala.annual$trans_4)-log(Haraqua_Hala.annual$trans_9))/log(500),
    alpha_600=-(log(Haraqua_Hala.annual$trans_5)-log(Haraqua_Hala.annual$trans_9))/log(600),
    alpha_700=-(log(Haraqua_Hala.annual$trans_6)-log(Haraqua_Hala.annual$trans_9))/log(700),
    alpha_800=-(log(Haraqua_Hala.annual$trans_7)-log(Haraqua_Hala.annual$trans_9))/log(800),
    alpha_900=-(log(Haraqua_Hala.annual$trans_8)-log(Haraqua_Hala.annual$trans_9))/log(900),
    alpha_1200=-(log(Haraqua_Hala.annual$trans_10)-
                   log(Haraqua_Hala.annual$trans_9))/log(1200),
    alpha_1600=-(log(Haraqua_Hala.annual$trans_11)-
                   log(Haraqua_Hala.annual$trans_9))/log(1600))|>
    dplyr::select(c('Date', starts_with('a'))) |>
    group_by(Date)|>
    summarise_at(vars(mutate.alpha), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 5, 6))# |>
    #rowMeans(na.rm = TRUE)

kable(do.call("rbind", list(SantaMaria.a, Ksudach.a, 
                      Novarupta.a, Katla.a, Raikoke.a)),
      align = c('l', rep('c', times = 11)))|>
  kable_classic()
```

# Southern Hemisphere

## Read the data

```{r}
Calama.annual <- read_csv('../../data/trans_Timeline/Calama.ok.csv')

Montezuma.annual <- read_csv('../../data/trans_Timeline/Montezuma.ok.csv')

Mt.Brukkaros.annual <- read_csv('../../data/trans_Timeline/Mt.Brukkaros.ok.csv')
```

## Transform all data set for Transmission

```{r}
selections <- c('Date', 'lambda_1', 'trans_1', 'lambda_2', 'trans_2', 'lambda_3',
                'trans_3','lambda_4', 'trans_4', 'lambda_5', 'trans_5', 'lambda_6', 
                'trans_6', 'lambda_7', 'trans_7','lambda_8', 'trans_8', 'lambda_9', 
                'trans_9', 'lambda_10', 'trans_10', 'lambda_11', 'trans_11')
            
Calama.annual <- Calama.annual|>
dplyr::mutate('lambda_8' = 0.9, 'trans_8' = NA)|>  
dplyr::rename(c('lambda_1' = 'lambda1...m.', 'lambda_2' = 'lambda2...m.',
                'lambda_3' = 'lambda3...m.', 'lambda_4' = 'lambda4...m.',
                'lambda_5' = 'lambda5...m.','lambda_6' = 'lambda6...m.',
                'lambda_7' = 'lambda7...m.','lambda_9' = 'lambda8...m.',
                'lambda_10' = 'lambda9...m.','lambda_11' = 'lambda10...m.',
                'trans_1' = 'transmission1....100.', 'trans_2' = 'transmission2....100.',
                'trans_3' = 'transmission3....100.','trans_4' = 'transmission4....100.',
                'trans_5' = 'transmission5....100.','trans_6' = 'transmission6....100.',
                'trans_7' = 'transmission7....100.','trans_9' = 'transmission8....100.',
                'trans_10' = 'transmission9....100.',
                'trans_11' = 'transmission10....100.'))|>
  dplyr::mutate(Date = lubridate::floor_date(Date, 'year'))|>   
  dplyr::select(selections) |>
  dplyr::mutate(across(2:23, ~ifelse(.x > 2, NA, .x)))
  
Calama.annual.long <- Calama.annual|>  
  pivot_longer(cols = starts_with('t'),
               names_to = 'variable',
               values_to = 'values') |>
  dplyr::mutate(variable = factor(variable,
                levels = c("trans_1", "trans_2", "trans_3", "trans_4", 
                           "trans_5", "trans_6", "trans_7", "trans_8",
                           "trans_9", "trans_10", "trans_11")))|> 
  dplyr::mutate(values = ifelse(values >= 2, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values)) |>
  group_by(variable, Date)|>
  summarise_at(vars(values), funs(mean(., na.rm = TRUE))) |>
  dplyr::mutate(values = ifelse(values >= 1, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values))

Montezuma.annual <- Montezuma.annual|>
dplyr::mutate('lambda_8' = 0.9, 'trans_8' = NA)|>  
dplyr::rename(c('lambda_1' = 'lambda1...m.', 'lambda_2' = 'lambda2...m.',
                'lambda_3' = 'lambda3...m.', 'lambda_4' = 'lambda4...m.',
                'lambda_5' = 'lambda5...m.','lambda_6' = 'lambda6...m.',
                'lambda_7' = 'lambda7...m.','lambda_9' = 'lambda8...m.',
                'lambda_10' = 'lambda9...m.','lambda_11' = 'lambda10...m.',
                'trans_1' = 'transmission1....100.', 'trans_2' = 'transmission2....100.',
                'trans_3' = 'transmission3....100.','trans_4' = 'transmission4....100.',
                'trans_5' = 'transmission5....100.','trans_6' = 'transmission6....100.',
                'trans_7' = 'transmission7....100.','trans_9' = 'transmission8....100.',
                'trans_10' = 'transmission9....100.',
                'trans_11' = 'transmission10....100.'))|>
  dplyr::mutate(Date = lubridate::floor_date(Date, 'year'))|>   
  dplyr::select(selections) |>
  dplyr::mutate(across(2:23, ~ifelse(.x > 2, NA, .x)))
  
Montezuma.annual.long <- Montezuma.annual|>
  pivot_longer(cols = starts_with('t'),
               names_to = 'variable',
               values_to = 'values') |>
  dplyr::mutate(variable = factor(variable,
                levels = c("trans_1", "trans_2", "trans_3", "trans_4", 
                           "trans_5", "trans_6", "trans_7", "trans_8",
                           "trans_9", "trans_10", "trans_11")))|> 
  dplyr::mutate(values = ifelse(values >= 2, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values)) |>
  group_by(variable, Date)|>
  summarise_at(vars(values), funs(mean(., na.rm = TRUE))) |>
  dplyr::mutate(values = ifelse(values >= 1, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values))

Montezuma.annual|>
  dplyr::filter(Date == as.Date("1922-01-01"))

Mt.Brukkaros.annual <- Mt.Brukkaros.annual|>
dplyr::mutate('lambda_9' = 1, 'trans_9' = NA)|>  
dplyr::rename(c('lambda_1' = 'lambda1...m.', 'lambda_2' = 'lambda2...m.',
                'lambda_3' = 'lambda3...m.', 'lambda_4' = 'lambda4...m.',
                'lambda_5' = 'lambda5...m.','lambda_6' = 'lambda6...m.',
                'lambda_7' = 'lambda7...m.','lambda_8' = 'lambda8...m.',
                'lambda_10' = 'lambda9...m.','lambda_11' = 'lambda10...m.',
                'trans_1' = 'transmission1....100.', 'trans_2' = 'transmission2....100.',
                'trans_3' = 'transmission3....100.','trans_4' = 'transmission4....100.',
                'trans_5' = 'transmission5....100.','trans_6' = 'transmission6....100.',
                'trans_7' = 'transmission7....100.','trans_8' = 'transmission8....100.',
                'trans_10' = 'transmission9....100.',
                'trans_11' = 'transmission10....100.'))|>
  dplyr::mutate(Date = lubridate::floor_date(Date, 'year'))|>   
  dplyr::select(selections) |>
  dplyr::mutate(across(2:23, ~ifelse(.x > 2, NA, .x)))

Mt.Brukkaros.annual.long <- Mt.Brukkaros.annual|>
  pivot_longer(cols = starts_with('t'),
               names_to = 'variable',
               values_to = 'values') |>
  dplyr::mutate(variable = factor(variable,
                levels = c("trans_1", "trans_2", "trans_3", "trans_4", 
                           "trans_5", "trans_6", "trans_7", "trans_8",
                           "trans_9", "trans_10", "trans_11")))|> 
  dplyr::mutate(values = ifelse(values >= 2, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values)) |>
  group_by(variable, Date)|>
  summarise_at(vars(values), funs(mean(., na.rm = TRUE))) |>
  dplyr::mutate(values = ifelse(values >= 1, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values))
```

## Transform all data sets for Optical Depth

```{r}
Calama.annual.od <- Calama.annual.long|>
    dplyr::mutate_at(c('values'), ~-log(.))

Montezuma.annual.od <- Montezuma.annual.long|>
    dplyr::mutate_at(c('values'), ~-log(.))

Mt.Brukkaros.annual.od <- Mt.Brukkaros.annual.long|>
    dplyr::mutate_at(c('values'), ~-log(.))
```

## Transform all data sets for Ångström Parameter

```{r}
Calama.annual.alpha <- read_csv('../../data/alpha_timeline/Calama.alpha.csv')

Montezuma.annual.alpha <- read_csv('../../data/alpha_timeline/Montezuma.alpha.csv')

Mt.Brukkaros.annual.alpha <- read_csv('../../data/alpha_timeline/Mt.Brukkaros.alpha.csv')
```

## Graphs of the Southern Hemisphere

### Timeline with Transmission

```{r}
conflicts_prefer(data.table::month)

southern.timeline.trans <- ggplot()+
  geom_point(data = Calama.annual.long, aes(x = Date, y = values, color = variable))+
  geom_point(data = Montezuma.annual.long, aes(x = Date, y = values, color = variable)) +
  geom_point(data = Mt.Brukkaros.annual.long, aes(x = Date, y = values, color = variable)) +
  geom_line(data = Calama.annual.long, aes(x = Date, y = values, color = variable))+
  geom_line(data = Montezuma.annual.long, aes(x = Date, y = values, color = variable)) +
  geom_line(data = Mt.Brukkaros.annual.long, aes(x = Date, y = values, color = variable)) +
  geom_rect(aes(xmin = as.Date("1918-01-01", format = '%Y-%m-%d'), 
                xmax = as.Date("1920-03-19", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +  
  geom_rect(aes(xmin = as.Date("1924-11-24", format = '%Y-%m-%d'), 
                xmax = as.Date("1925-05-26", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +  
  annotate("text", x = as.Date("1920-03-19", format = '%Y-%m-%d'),
  y = .3, label= "Katla [NEEM-S1]", hjust = 0, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) + 
  annotate("text", x = as.Date("1925-05-26", format = '%Y-%m-%d'),
  y = .3, label= "Raikoke [NEEM-S1]", hjust = 0, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) +   
  geom_vline(xintercept = as.numeric(as.Date("1918-10-12")), linetype = 'dotted') + 
  geom_vline(xintercept = as.numeric(as.Date("1924-02-15")), linetype = 'dotted') +  
  geom_vline(xintercept = as.numeric(as.Date("1922-01-01")), 
             linetype = 'dotted', color = 'red')+
  annotate("text", x = as.Date("1922-01-01", format = '%Y-%m-%d'),
  y = .3, label= "Potential Volcanic Event", hjust = 0, vjust = -0.2, 
  angle = 90, alpha = 0.5, color = 'red', size = 4.5) +   
  annotate("text", x = as.Date("1918-10-12", format = '%Y-%m-%d'),
  y = .3, label= "Katla [1918-10-12]", hjust = 0, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) + 
  annotate("text", x = as.Date("1924-02-15", format = '%Y-%m-%d'),
  y = .3, label= "Raikoke [1924-02-15]", hjust = 0, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) + 
  labs(x = 'Time [year]', y = 'Annual mean of the transmission [ ]') +  
  scale_color_viridis_d(option = "viridis", 
                        guide = guide_legend(override.aes = list(size = 3,alpha = 1),
                        title = "Wavelength [nm]"), 
                        label = c('340 - 360' ,'390 - 410', '440 - 460', '490 - 510', 
                                 '590 - 610', '700 - 725', '790 - 810','890 - 910', 
                                 '990 -1010', '1190 - 1210', '1590 - 1610')) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))+
  theme(text = element_text(size = 20))  

southern.timeline.trans 
```

#### Statistics

```{r}
Calama.annual.long|>
  group_by(variable) |>
  summarise_at(vars(values), funs(Min = min(., na.rm = TRUE), 
                                  Max = max(., na.rm = TRUE), 
                                  Median = median(., na.rm = TRUE),
                                  Mean = mean(., na.rm = TRUE),
                                  Std = sd(., na.rm = TRUE),
                                  IQR = IQR(.,na.rm = TRUE),
                                  Span = max(., na.rm = TRUE) - min(., na.rm = TRUE),
                                  '0.25.quantile' = quantile(., probs = .25, na.rm = TRUE),
                                  '0.75.quantile' = quantile(., probs = .75, na.rm = TRUE)))

Montezuma.annual.long|>
  group_by(variable) |>
  summarise_at(vars(values), funs(Min = min(., na.rm = TRUE), 
                                  Max = max(., na.rm = TRUE), 
                                  Median = median(., na.rm = TRUE),
                                  Mean = mean(., na.rm = TRUE),
                                  Std = sd(., na.rm = TRUE),
                                  IQR = IQR(.,na.rm = TRUE),
                                  Span = max(., na.rm = TRUE) - min(., na.rm = TRUE),
                                  '0.25.quantile' = quantile(., probs = .25, na.rm = TRUE),
                                  '0.75.quantile' = quantile(., probs = .75, na.rm = TRUE)))

Mt.Brukkaros.annual.long|>
  group_by(variable) |>
  summarise_at(vars(values), funs(Min = min(., na.rm = TRUE), 
                                  Max = max(., na.rm = TRUE), 
                                  Median = median(., na.rm = TRUE),
                                  Mean = mean(., na.rm = TRUE),
                                  Std = sd(., na.rm = TRUE),
                                  IQR = IQR(.,na.rm = TRUE),
                                  Span = max(., na.rm = TRUE) - min(., na.rm = TRUE),
                                  '0.25.quantile' = quantile(., probs = .25, na.rm = TRUE),
                                  '0.75.quantile' = quantile(., probs = .75, na.rm = TRUE)))
```

#### Signal Extractor Transmission

```{r}
signal.extractor(Montezuma.annual|>
    group_by(Date)|>
    summarise_at(vars(mutate), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 2, 3)

signal.extractor(Montezuma.annual|>
    dplyr::mutate_at(mutate , ~-log(.)) |>
    group_by(Date)|>
    summarise_at(vars(mutate), list(mean = ~ mean(., na.rm = TRUE)))|>
    dplyr::select(-'Date'), 2, 3)
```

### Timeline with Optical Depth

```{r}
conflicts_prefer(data.table::month)

southern.timeline.od <- ggplot()+
  geom_point(data = Calama.annual.od, aes(x = Date, y = values, color = variable))+
  geom_point(data = Montezuma.annual.od, aes(x = Date, y = values, color = variable)) +
  geom_point(data = Mt.Brukkaros.annual.od, aes(x = Date, y = values, color = variable)) +
  geom_line(data = Calama.annual.od, aes(x = Date, y = values, color = variable))+
  geom_line(data = Montezuma.annual.od, aes(x = Date, y = values, color = variable)) +
  geom_line(data = Mt.Brukkaros.annual.od, aes(x = Date, y = values, color = variable)) +
  geom_rect(aes(xmin = as.Date("1918-01-01", format = '%Y-%m-%d'), 
                xmax = as.Date("1920-03-19", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +  
  geom_rect(aes(xmin = as.Date("1924-11-24", format = '%Y-%m-%d'), 
                xmax = as.Date("1925-05-26", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +  
  annotate("text", x = as.Date("1920-03-19", format = '%Y-%m-%d'),
  y = 1.2, label= "Katla [NEEM-S1]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) + 
  annotate("text", x = as.Date("1925-05-26", format = '%Y-%m-%d'),
  y = 1.2, label= "Raikoke [NEEM-S1]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) +   
  geom_vline(xintercept = as.numeric(as.Date("1918-10-12")), linetype = 'dotted') + 
  geom_vline(xintercept = as.numeric(as.Date("1924-02-15")), linetype = 'dotted') +  
  geom_vline(xintercept = as.numeric(as.Date("1922-01-01")), 
             linetype = 'dotted', color = 'red')+
  annotate("text", x = as.Date("1922-01-01", format = '%Y-%m-%d'),
  y = 0.5, label= "+3.3% to +58%", hjust = 0.5, vjust = +0.2, 
  angle = 0, alpha = 0.5, color = 'red', size = 4.5) +      
  annotate("text", x = as.Date("1922-01-01", format = '%Y-%m-%d'),
  y = 1.2, label= "Potential Volcanic Event", hjust = 1, vjust = -0.2, 
  angle = 90, alpha = 0.5, color = 'red', size = 4.5) +     
  annotate("text", x = as.Date("1918-10-12", format = '%Y-%m-%d'),
  y = 1.2, label= "Katla [1918-10-12]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) + 
  annotate("text", x = as.Date("1924-02-15", format = '%Y-%m-%d'),
  y = 1.2, label= "Raikoke [1924-02-15]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5, size = 4.5) + 
  labs(x = 'Time [year]', y = 'Annual mean of the optical depth [ ]') +  
  scale_color_viridis_d(option = "viridis", 
                        guide = guide_legend(override.aes = list(size = 3,alpha = 1),
                        title = "Wavelength [nm]"), 
                        label = c('340 - 360' ,'390 - 410', '440 - 460', '490 - 510', 
                                 '590 - 610', '700 - 725', '790 - 810','890 - 910', 
                                 '990 -1010', '1190 - 1210', '1590 - 1610')) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1)) +
  theme(text = element_text(size = 20))

southern.timeline.od
```

#### Statistics

```{r}
Calama.annual.od|>
  group_by(variable) |>
  summarise_at(vars(values), funs(Min = min(., na.rm = TRUE), 
                                  Max = max(., na.rm = TRUE), 
                                  Median = median(., na.rm = TRUE),
                                  Mean = mean(., na.rm = TRUE),
                                  Std = sd(., na.rm = TRUE),
                                  IQR = IQR(.,na.rm = TRUE),
                                  Span = max(., na.rm = TRUE) - min(., na.rm = TRUE),
                                  '0.25.quantile' = quantile(., probs = .25, na.rm = TRUE),
                                  '0.75.quantile' = quantile(., probs = .75, na.rm = TRUE)))

Montezuma.annual.od|>
  group_by(variable) |>
  summarise_at(vars(values), funs(Min = min(., na.rm = TRUE), 
                                  Max = max(., na.rm = TRUE), 
                                  Median = median(., na.rm = TRUE),
                                  Mean = mean(., na.rm = TRUE),
                                  Std = sd(., na.rm = TRUE),
                                  IQR = IQR(.,na.rm = TRUE),
                                  Span = max(., na.rm = TRUE) - min(., na.rm = TRUE),
                                  '0.25.quantile' = quantile(., probs = .25, na.rm = TRUE),
                                  '0.75.quantile' = quantile(., probs = .75, na.rm = TRUE)))

Mt.Brukkaros.annual.od|>
  group_by(variable) |>
  summarise_at(vars(values), funs(Min = min(., na.rm = TRUE), 
                                  Max = max(., na.rm = TRUE), 
                                  Median = median(., na.rm = TRUE),
                                  Mean = mean(., na.rm = TRUE),
                                  Std = sd(., na.rm = TRUE),
                                  IQR = IQR(.,na.rm = TRUE),
                                  Span = max(., na.rm = TRUE) - min(., na.rm = TRUE),
                                  '0.25.quantile' = quantile(., probs = .25, na.rm = TRUE),
                                  '0.75.quantile' = quantile(., probs = .75, na.rm = TRUE)))
```

### Timeline with Ångström Parameter

```{r}
conflicts_prefer(data.table::month)

southern.timeline.alpha <- ggplot()+
  geom_point(data = Calama.annual.alpha, aes(x = month, y = values, color = variable))+
  geom_point(data = Montezuma.annual.alpha, aes(x = month, y = values, color = variable)) +
  geom_point(data = Mt.Brukkaros.annual.alpha, aes(x = month, y = values, color = variable)) +
  geom_line(data = Calama.annual.alpha, aes(x = month, y = values, color = variable))+
  geom_line(data = Montezuma.annual.alpha, aes(x = month, y = values, color = variable)) +
  geom_line(data = Mt.Brukkaros.annual.alpha, aes(x = month, y = values, color = variable)) +
  geom_rect(aes(xmin = as.Date("1918-01-01", format = '%Y-%m-%d'), 
                xmax = as.Date("1920-03-19", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +  
  geom_rect(aes(xmin = as.Date("1924-11-24", format = '%Y-%m-%d'), 
                xmax = as.Date("1925-05-26", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "lightskyblue1", alpha = 0.1, fill = "lightskyblue1", linewidth = 0.2) +  
  annotate("text", x = as.Date("1920-03-19", format = '%Y-%m-%d'),
  y = .2, label= "Katla [NEEM-S1]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5) + 
  annotate("text", x = as.Date("1925-05-26", format = '%Y-%m-%d'),
  y = .2, label= "Raikoke [NEEM-S1]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5) +   
  geom_vline(xintercept = as.numeric(as.Date("1918-10-12")), linetype = 'dotted') + 
  geom_vline(xintercept = as.numeric(as.Date("1924-02-15")), linetype = 'dotted') +  
  annotate("text", x = as.Date("1918-10-12", format = '%Y-%m-%d'),
  y = .2, label= "Katla [1918-10-12]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5) + 
  annotate("text", x = as.Date("1924-02-15", format = '%Y-%m-%d'),
  y = .2, label= "Raikoke [1924-02-15]", hjust = 1, vjust = -0.2, angle = 90, alpha = 0.5) + 
  labs(x = 'Time [year]', y = 'Annual mean of the Ångström Parameter [ ]') + 
  scale_y_continuous(limits = c(-0.05,0.2)) +    
  scale_color_viridis_d(option = "viridis", 
                        guide = guide_legend(override.aes = list(size = 3,alpha = 1),
                        title = "Wavelength [nm]"), 
                        label = c('340 - 360' ,'390 - 410', '440 - 460', '490 - 510', 
                                 '590 - 610', '700 - 725', '790 - 810','890 - 910', 
                                 '990 -1010', '1190 - 1210', '1590 - 1610')) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1)) +
  theme(text = element_text(size = 20))  
```

# PDFs

## Northern Hemisphere

```{r}
pdf('../../analysis/Time_Lines/Northern.Timeline.trans.pdf',
    width = 15, height = 6)
northern.timeline.trans
dev.off()

pdf('../../analysis/Time_Lines/Northern.Timeline.od.pdf',
    width = 15, height = 6)
northern.timeline.od 
dev.off()

pdf('../../analysis/Time_Lines/Northern.Timeline.alpha.pdf',
    width = 15, height = 6)
northern.timeline.alpha
dev.off()
```

## Southern Hemisphere

```{r}
pdf('../../analysis/Time_Lines/Southern.Timeline.trans.pdf',
    width = 15, height = 6)
southern.timeline.trans
dev.off()

pdf('../../analysis/Time_Lines/Southern.Timeline.od.pdf',
    width = 15, height = 6)
southern.timeline.od 
dev.off()

pdf('../../analysis/Time_Lines/Southern.Timeline.alpha.pdf',
    width = 15, height = 6)
southern.timeline.alpha
dev.off()
```
