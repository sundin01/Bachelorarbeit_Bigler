---
title: "Bachelorarbeit: Introduction"
author: "Patrick Bigler"
date: "2023-07-07"
output:
  html_document:
    toc: yes
    toc_float: yes
    number_sections: yes
  '': default
editor_options:
  markdown:
    wrap: 75
---

# Introduction

## Read packages

```{r Package, message=FALSE, error=FALSE, warning=FALSE}
source("../R/General/packages.R")

conflicts_prefer(ggplot2::annotate)
```

## Read files

Here, we read all digitized data sets. For a comprehensive analysis, it is
important to have enough data. Therefore, only data sets containing more
than 40 measurements are used. The following data sets were not considered:

-   Bassour (13 measurements)

-   Mt. Whitney (5 Measurements)

-   Mt.Wilson (5 Measurements)

-   Mt. Wilson (20Measurements)

-   Mt. Wilson (18 Measurements)

```{r Read_data, message=FALSE, error=FALSE, warning=FALSE}
Bassour.1911.1912 <- read.delim("../Data/Bassour.txt")

Montezuma.1920.1930 <- read.delim("../Data/Montezuma.txt")

Harqua_Hala.1920.1925 <- read.delim("../Data/Harqua_Hala.txt")

Mt.Wilson.1905.1920 <- read.delim("../Data/Mt_Wilson_1.txt")

Mt.Wilson.1905.1906 <- read.delim("../Data/Mt_Wilson_2.txt")

Mt.Wilson.1909.1912 <- read.delim("../Data/Mt_Wilson_3.txt")

Washington.1902.1904 <- read.delim("../Data/Washington_1.txt")

Washington.1903.1907 <- read.delim("../Data/Washington_2.txt")

Hump_Mountain.1917.1918 <- read.delim("../Data/Hump_Mountain.txt")

Calama.1918.1920 <- read.delim("../Data/Calama.txt")

Mt.Brukkaros.1926.1930 <- read.delim("../Data/Mt_Brukkaros.txt")

Mt.Whitney.1909.1910 <- read.delim("../Data/Mounth_Whitney.txt")

Table.mountain.1925.1930 <- read.delim("../Data/Table_mountain.txt")
```

## Coordinates-Transformation

Here, we transform coordinates in the WGS84 system

```{r coordinates_transformation, message=FALSE, error=FALSE, warning=FALSE}
source("../R/function.coordinate.transformation.R")
Katmai.lat <- coordinates.transfomation(58, 16, 43)
Katmai.lon <- coordinates.transfomation(-154, -57, -24.9)

Santa.Maria.lat <- coordinates.transfomation(14, 45, 20)
Santa.Maria.lon <- coordinates.transfomation(-91, -33, -6)

katla.lat <- coordinates.transfomation(63, 37, 50)
katla.lon <- coordinates.transfomation(-19, -3, -0)

ksudach.lat <- coordinates.transfomation(51, 48, 26)
ksudach.lon <- coordinates.transfomation(157, 32, 3)

raikoke.lat <- coordinates.transfomation(48, 17, 30)
raikoke.lon <- coordinates.transfomation(153, 14, 30)

Montezuma.lat <- coordinates.transfomation(-22, -40, -0)
Montezuma.lon <- coordinates.transfomation(-68, -56, -0)

Calama.lat <- coordinates.transfomation(-22, -28, -0)
Calama.lon <- coordinates.transfomation(-68, -56, -0)

Table.Mountain.lat <- coordinates.transfomation(34, 22, 0)
Table.Mountain.lon <- coordinates.transfomation(-117, -41, -0)

Harqua.Hala.lat <- coordinates.transfomation(33, 48, 0)
Harqua.Hala.lon <- coordinates.transfomation(-113, -20, 0)

Mount.Brukkaros.lat <- coordinates.transfomation(-25, -52, -0)
Mount.Brukkoras.lon <- coordinates.transfomation(17, 48, 0)

Mount.Wilson.lat <- coordinates.transfomation(34, 12, 55)
Mount.Wilson.lon <- coordinates.transfomation(-118, -17, -29)

Washington.lat <- coordinates.transfomation(38, 53, 17.3)
Washingtons.lon <- coordinates.transfomation(-77, -01, -33.6)

Hump.Mountain.lat <- coordinates.transfomation(36, 8, 0)
Hump.Mountain.lon <- coordinates.transfomation(-82, 0, 0)

antarctica.lat <- -79.47
antarctica.lon <- -112.09

greenland.lat <- 77.45
greenland.lon <- -51.06
```

## Visualize the locations

Here, we create a tibble for all location. We need that for mapping the
locations.

```{r mapping_preparation, message=FALSE, error=FALSE, warning=FALSE}
df.locations <- tibble("Location" =
c("WDC06A", "NEEM-S1" ,"Katmai", "Santa Maria", "Katla", "Ksudach", "Raikoke", "Montezuma",
"Calama", "Table Mountain", "Harqua Hala",
"Mt. Brukkaros", "Mt. Wilson",
"Washington","Hump Mountain"),
"latitude" =
c(antarctica.lat,greenland.lat ,Katmai.lat, Santa.Maria.lat, katla.lat, ksudach.lat, raikoke.lat, Montezuma.lat,
Calama.lat, Table.Mountain.lat, Harqua.Hala.lat,
Mount.Brukkaros.lat,
Mount.Wilson.lat, Washington.lat,
Hump.Mountain.lat),
"longitude" =
c(antarctica.lon, greenland.lon  ,Katmai.lon, Santa.Maria.lon, katla.lon , ksudach.lon, raikoke.lon , Montezuma.lon,
Calama.lon, Table.Mountain.lon, Harqua.Hala.lon,
Mount.Brukkoras.lon,
Mount.Wilson.lon, Washingtons.lon,
Hump.Mountain.lon),
"Altitude" =
c(NA, NA ,2047, 3772, 1512, 1079, 551, 2711, 2250, 2286, 1721,
1586, 1727, 10, 2250),
"Legend" =
c(rep("Ice core",2) ,rep("Volcano",5), rep("Observation station", 8)))
```

```{r mapping_locations, message=FALSE, error=FALSE, warning=FALSE}
#read the world map
world_map <- map_data("world")
# map the locations

overview.plot <- ggplot() +
  geom_map(data = world_map, map = world_map,
  aes(long, lat, map_id = region),
  color = "white", fill = "lightgray", size = 0.1) +
  geom_point(data = df.locations, aes(x = `longitude`, y = `latitude`,
  color = Legend), size = 0.5) +
  scale_y_continuous(limits = c(-80, 80)) +
  scale_x_continuous(limits = c(-180, 180)) +
  labs(x = "Longitude [deg]", y = "Latitude [deg]") +
  theme_light() +
  geom_label_repel(aes(x = df.locations$longitude, y = df.locations$latitude ,
  label = df.locations$Location, color = df.locations$Legend,
  size = NULL), nudge_y = 1.5, nudge_x = 1.5, box.padding = 0.35, point.padding = 0.5,
  min.segment.length = 0.01, segment.color = 'black', max.overlaps = Inf, show.legend = FALSE,
  max.time = 5, max.iter = 100000) +
  guides(color = guide_legend(override.aes = list(size = 3) ) )+
  theme(legend.background = element_rect(fill = "white", linewidth = 0.5, 
                                       linetype = "solid", colour = "black")) +
  theme(legend.position = c(.98, .035),
      legend.justification = c("right", "bottom"), legend.box.just = "right",
      legend.margin = margin(6, 6, 6, 6)) +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))


overview.plot

pdf('../analysis/General/map.pdf',
    width = 8, height = 5)
overview.plot
dev.off()
```

# Quality of the Data

## Preparation

```{r Preparation_datasets, message=FALSE, error=FALSE, warning=FALSE}

################################################################################
# Calama
################################################################################

Calama.1918.1920 <- Calama.1918.1920|>
  dplyr::mutate('Date' = lubridate::ymd(paste(Calama.1918.1920$year,
                                              Calama.1918.1920$month,
                                              Calama.1918.1920$day,
                                              sep = ' ')))|>
  dplyr::select(-c('year', 'month', 'day'))
Calama.1918.1920 <- replace(Calama.1918.1920, Calama.1918.1920 == -999, NA)

################################################################################
# Haraqua Hala
################################################################################

Harqua_Hala.1920.1925 <- Harqua_Hala.1920.1925|>
  dplyr::mutate('Date' = lubridate::ymd(paste(Harqua_Hala.1920.1925$year,
                                              Harqua_Hala.1920.1925$month,
                                              Harqua_Hala.1920.1925$day,
                                              sep = ' ')))|>
  dplyr::select(-c('year', 'month', 'day'))
Harqua_Hala.1920.1925 <- replace(Harqua_Hala.1920.1925, Harqua_Hala.1920.1925 == -999, NA)

################################################################################
# Hump Mountain
################################################################################

Hump_Mountain.1917.1918 <- Hump_Mountain.1917.1918|>
  dplyr::mutate('Date' = lubridate::ymd(paste(Hump_Mountain.1917.1918$year,
                                              Hump_Mountain.1917.1918$month,
                                              Hump_Mountain.1917.1918$day,
                                              sep = ' ')))|>
  dplyr::select(-c('year', 'month', 'day'))
Hump_Mountain.1917.1918 <- replace(Hump_Mountain.1917.1918, 
                                   Hump_Mountain.1917.1918 == -999, NA)


################################################################################
# Mt. Brukkaros
################################################################################

Mt.Brukkaros.1926.1930 <- Mt.Brukkaros.1926.1930|>
  dplyr::mutate('Date' = lubridate::ymd(paste(Mt.Brukkaros.1926.1930$year,
                                            Mt.Brukkaros.1926.1930$month,
                                            Mt.Brukkaros.1926.1930$day,
                                            sep = ' ')))|>
  dplyr::select(-c('year', 'month', 'day'))
Mt.Brukkaros.1926.1930 <- replace(Mt.Brukkaros.1926.1930, Mt.Brukkaros.1926.1930 == -999, NA)

################################################################################
# Table Mountain
################################################################################

Table.mountain.1925.1930 <- Table.mountain.1925.1930|>
  dplyr::mutate('Date' = lubridate::ymd(paste(Table.mountain.1925.1930$year,
                                              Table.mountain.1925.1930$month,
                                              Table.mountain.1925.1930$day,
                                              sep = ' ')))|>
  dplyr::select(-c('year', 'month', 'day'))

Table.mountain.1925.1930 <- replace(Table.mountain.1925.1930, 
                                    Table.mountain.1925.1930 == -999, NA)
```
