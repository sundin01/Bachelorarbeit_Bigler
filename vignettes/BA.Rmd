---
title: "BA"
author: "Patrick Bigler"
date: "2023-07-07"
output: html_document
---

# Introduction

## Read packages

```{r message=FALSE, error=FALSE, warning=FALSE}
source("../R/General/packages.R")

conflicts_prefer(ggplot2::annotate)
```

## Read files

```{r}
Bassour.1911.1912 <- read.delim("../Data/Bassour.txt")

Montezuma.1920.1930 <- read.delim("../Data/Montezuma.txt")

Harqua_Hala.1920.1925 <- read.delim("../Data/Harqua_Hala.txt")

Mt.Wilson.1905.1920 <- read.delim("../Data/Mt_Wilson_1.txt")

Mt.Wilson.1905.1906 <- read.delim("../Data/Mt_Wilson_2.txt")

Mt.Wilson.1909.1912 <- read.delim("../Data/Mt_Wilson_3.txt")

Washington.1902.1904 <- read.delim("../Data/Washington_1.txt")

Washington.1903.1907 <- read.delim("../Data/Washington_2.txt")

Hump_Mountain.1917.1918 <- read.delim("../Data/Hump_Mountain.txt")

Calama.1918.1920 <- read.delim("../Data/Calama.txt")

Mt.Brukkaros.1926.1930 <- read.delim("../Data/Mt_Brukkaros.txt")

Mt.Whitney.1909.1910 <- read.delim("../Data/Mounth_Whitney.txt")

Table.mountain.1925.1930 <- read.delim("../Data/Table_mountain.txt")
```

## Coordinates-Transformation

```{r}
source("../R/function.coordinate.transformation.R")
Katmai.lat <- coordinates.transfomation(58, 16, 43)
Katmai.lon <- coordinates.transfomation(-154, -57, -24.9)

Santa.Maria.lat <- coordinates.transfomation(14, 45, 20)
Santa.Maria.lon <- coordinates.transfomation(-91, -33, -6)

katla.lat <- coordinates.transfomation(63, 37, 50)
katla.lon <- coordinates.transfomation(-19, -3, -0)

ksudach.lat <- coordinates.transfomation(51, 48, 26)
ksudach.lon <- coordinates.transfomation(157, 32, 3)

raikoke.lat <- coordinates.transfomation(48, 17, 30)
raikoke.lon <- coordinates.transfomation(153, 14, 30)

Montezuma.lat <- coordinates.transfomation(-22, -40, -0)
Montezuma.lon <- coordinates.transfomation(-68, -56, -0)

Calama.lat <- coordinates.transfomation(-22, -28, -0)
Calama.lon <- coordinates.transfomation(-68, -56, -0)

Table.Mountain.lat <- coordinates.transfomation(34, 22, 0)
Table.Mountain.lon <- coordinates.transfomation(-117, -41, -0)

Harqua.Hala.lat <- coordinates.transfomation(33, 48, 0)
Harqua.Hala.lon <- coordinates.transfomation(-113, -20, 0)

Mount.Brukkaros.lat <- coordinates.transfomation(-25, -52, -0)
Mount.Brukkoras.lon <- coordinates.transfomation(17, 48, 0)

Mount.Wilson.lat <- coordinates.transfomation(34, 12, 55)
Mount.Wilson.lon <- coordinates.transfomation(-118, -17, -29)

Washington.lat <- coordinates.transfomation(38, 53, 17.3)
Washingtons.lon <- coordinates.transfomation(-77, -01, -33.6)

Hump.Mountain.lat <- coordinates.transfomation(36, 8, 0)
Hump.Mountain.lon <- coordinates.transfomation(-82, 0, 0)

antarctica.lat <- -79.47
antarctica.lon <- -112.09

greenland.lat <- 77.45
greenland.lon <- -51.06
```

## Create a tibble

```{r}
df.locations <- tibble("Location" =
c("WDC06A", "NEEM-S1" ,"Katmai", "Santa Maria", "Katla", "Ksudach", "Raikoke", "Montezuma",
"Calama", "Table Mountain", "Harqua Hala",
"Mt. Brukkaros", "Mt. Wilson",
"Washington","Hump Mountain"),
"latitude" =
c(antarctica.lat,greenland.lat ,Katmai.lat, Santa.Maria.lat, katla.lat, ksudach.lat, raikoke.lat, Montezuma.lat,
Calama.lat, Table.Mountain.lat, Harqua.Hala.lat,
Mount.Brukkaros.lat,
Mount.Wilson.lat, Washington.lat,
Hump.Mountain.lat),
"longitude" =
c(antarctica.lon, greenland.lon  ,Katmai.lon, Santa.Maria.lon, katla.lon , ksudach.lon, raikoke.lon , Montezuma.lon,
Calama.lon, Table.Mountain.lon, Harqua.Hala.lon,
Mount.Brukkoras.lon,
Mount.Wilson.lon, Washingtons.lon,
Hump.Mountain.lon),
"Altitude" =
c(NA, NA ,2047, 3772, 1512, 1079, 551, 2711, 2250, 2286, 1721,
1586, 1727, 10, 2250),
"Legend" =
c(rep("Ice core",2) ,rep("Volcano",5), rep("Observation station", 8)))
```

## Visualize the overview

```{r}
#read the world map
world_map <- map_data("world")
# map the locations

overview.plot <- ggplot() +
  geom_map(data = world_map, map = world_map,
  aes(long, lat, map_id = region),
  color = "white", fill = "lightgray", size = 0.1) +
  geom_point(data = df.locations, aes(x = `longitude`, y = `latitude`,
  color = Legend), size = 0.5) +
  scale_y_continuous(limits = c(-80, 80)) +
  scale_x_continuous(limits = c(-180, 180)) +
  labs(x = "Longitude [deg]", y = "Latitude [deg]") +
  theme_light() +
  geom_label_repel(aes(x = df.locations$longitude, y = df.locations$latitude ,
  label = df.locations$Location, color = df.locations$Legend,
  size = NULL), nudge_y = 1.5, nudge_x = 1.5, box.padding = 0.35, point.padding = 0.5,
  min.segment.length = 0.01, segment.color = 'black', max.overlaps = Inf, show.legend = FALSE,
  max.time = 5, max.iter = 100000) +
  guides(color = guide_legend(override.aes = list(size = 3) ) )+
  theme(legend.background = element_rect(fill = "white", linewidth = 0.5, 
                                       linetype = "solid", colour = "black")) +
  theme(legend.position = c(.98, .035),
      legend.justification = c("right", "bottom"), legend.box.just = "right",
      legend.margin = margin(6, 6, 6, 6)) +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))


overview.plot

pdf('../analysis/map.pdf',
    width = 8, height = 5)
overview.plot
dev.off()

```

# Analysis

## Preparation

```{r warning=FALSE, error=FALSE, message=FALSE}

################################################################################
# Calama
################################################################################

Calama.1918.1920 <- Calama.1918.1920|>
  dplyr::mutate('Date' = lubridate::ymd(paste(Calama.1918.1920$year,
                                              Calama.1918.1920$month,
                                              Calama.1918.1920$day,
                                              sep = ' ')))|>
  dplyr::select(-c('year', 'month', 'day'))
Calama.1918.1920 <- replace(Calama.1918.1920, Calama.1918.1920 == -999, NA)

################################################################################
# Haraqua Hala
################################################################################

Harqua_Hala.1920.1925 <- Harqua_Hala.1920.1925|>
  dplyr::mutate('Date' = lubridate::ymd(paste(Harqua_Hala.1920.1925$year,
                                              Harqua_Hala.1920.1925$month,
                                              Harqua_Hala.1920.1925$day,
                                              sep = ' ')))|>
  dplyr::select(-c('year', 'month', 'day'))
Harqua_Hala.1920.1925 <- replace(Harqua_Hala.1920.1925, Harqua_Hala.1920.1925 == -999, NA)

################################################################################
# Hump Mountain
################################################################################

Hump_Mountain.1917.1918 <- Hump_Mountain.1917.1918|>
  dplyr::mutate('Date' = lubridate::ymd(paste(Hump_Mountain.1917.1918$year,
                                              Hump_Mountain.1917.1918$month,
                                              Hump_Mountain.1917.1918$day,
                                              sep = ' ')))|>
  dplyr::select(-c('year', 'month', 'day'))
Hump_Mountain.1917.1918 <- replace(Hump_Mountain.1917.1918, 
                                   Hump_Mountain.1917.1918 == -999, NA)

################################################################################
# Montezuma
################################################################################

Montezuma.1920.1930 <- Montezuma.1920.1930|>
  dplyr::mutate('Date' = lubridate::ymd(paste(Montezuma.1920.1930$year,
                                              Montezuma.1920.1930$month,
                                              Montezuma.1920.1930$day,
                                              sep = ' ')))|>
  dplyr::select(-c('year', 'month', 'day'))

################################################################################
# Mt. Wilson
################################################################################

Mt.Wilson.1905.1920 <- Mt.Wilson.1905.1920|>
  dplyr::mutate('Date' = lubridate::ymd(paste(Mt.Wilson.1905.1920$year,
                                              Mt.Wilson.1905.1920$month,
                                              Mt.Wilson.1905.1920$day,
                                              sep = ' ')))|>
  dplyr::select(-c('year', 'month', 'day'))|>
  dplyr::mutate(row = seq(1 : length(Mt.Wilson.1905.1920$Location)))

Mt.Wilson.1905.1920 <- replace(Mt.Wilson.1905.1920, Mt.Wilson.1905.1920 == -999, NA)

################################################################################
# Mt. Brukkaros
################################################################################

Mt.Brukkaros.1926.1930 <- Mt.Brukkaros.1926.1930|>
  dplyr::mutate('Date' = lubridate::ymd(paste(Mt.Brukkaros.1926.1930$year,
                                            Mt.Brukkaros.1926.1930$month,
                                            Mt.Brukkaros.1926.1930$day,
                                            sep = ' ')))|>
  dplyr::select(-c('year', 'month', 'day'))
Mt.Brukkaros.1926.1930 <- replace(Mt.Brukkaros.1926.1930, Mt.Brukkaros.1926.1930 == -999, NA)

################################################################################
# Table Mountain
################################################################################

Table.mountain.1925.1930 <- Table.mountain.1925.1930|>
  dplyr::mutate('Date' = lubridate::ymd(paste(Table.mountain.1925.1930$year,
                                              Table.mountain.1925.1930$month,
                                              Table.mountain.1925.1930$day,
                                              sep = ' ')))|>
  dplyr::select(-c('year', 'month', 'day'))

Table.mountain.1925.1930 <- replace(Table.mountain.1925.1930, 
                                    Table.mountain.1925.1930 == -999, NA)

################################################################################
# Washington
################################################################################

Washington.1902.1904 <- Washington.1902.1904|>
  dplyr::mutate('Date' = lubridate::ymd(paste(year, month, day, sep = ' ')))|>
  dplyr::select(-c('year', 'month', 'day'))
Washington.1902.1904 <- replace(Washington.1902.1904, Washington.1902.1904 == -999, NA)
################################################################################
Washington.1903.1907 <- Washington.1903.1907|>
dplyr::mutate('Date' = lubridate::ymd(paste(year, month, day, sep = ' ')))|>
dplyr::select(-c('year', 'month', 'day'))
Washington.1903.1907 <- replace(Washington.1903.1907, Washington.1903.1907 == -999, NA)
```

### Calama

### Haraqua Hala

### Hump Mountain

### Montezuma

```{r}
pdf('../analysis/montezuma.1920.1930.pdf',
    width = 8, height = 5)
Montezuma.1920.1930|>
  dplyr::rename('400' = transmission1....100.,
                '450' = transmission2....100.,
                '500' = transmission3....100.,
                '600' = transmission4....100.,
                '700' = transmission5....100.,
                '800' = transmission6....100.,
                '900' = transmission7....100.,
                '1000' = transmission8....100.,
                '1200' = transmission9....100.,
                '1600' = transmission10....100.) |>
  dplyr::select(ends_with('0'), Date)|>
  pivot_longer(cols = ends_with('0'),
               names_to = 'variable',
               values_to = 'values')|>
dplyr::mutate(variable = factor(variable,
                                levels = c("400", "450", "500", "600", "700",
                                      "800", "900", "1000", "1200", "1600")))|>
  dplyr::mutate(values = ifelse(values >= 1, values/1000, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values)) |>
  drop_na()|>
  ggplot()+
  geom_point(aes(x = Date, y = values, color = variable)) +
  geom_vline(xintercept = as.numeric(as.Date("1924-02-15")), linetype = 'dotted') +
  annotate("text", x = as.Date("1924-02-15", format = '%Y-%m-%d'),
  y = 0, label= "Raikoke [1924-02-15]", hjust = 0, vjust = -0.2, angle = 90) +
  labs(x = 'Date', y = 'Transmittance [%]') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))
dev.off()
################################################################################
# Zoom in 
pdf('../analysis/montezuma.2923.raikoke.pdf',
    width = 8, height = 5)
Montezuma.1920.1930|>
  dplyr::rename('350' = transmission1....100.,
                '400' = transmission2....100.,
                '450' = transmission3....100.,
                '500' = transmission4....100.,
                '600' = transmission5....100.,
                '700' = transmission6....100.,
                '800' = transmission7....100.,
                '1000' = transmission8....100.,
                '1200' = transmission9....100.,
                '1600' = transmission10....100.) |>
  dplyr::mutate(Row = c(1 : length(Date))) |>
  pivot_longer(cols = ends_with('0'),
               names_to = 'variable',
               values_to = 'values')|>
  dplyr::mutate(variable = factor(variable,
                levels = c("350", "400", "450", "500", "600", "700", 
                           "800", "1000", "1200", "1600")))|>
  dplyr::mutate(values = ifelse(values >= 1, values/1000, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values)) |>
  dplyr::filter(Date > as_date('1923-01-01') & Date < as_date('1926-01-01')) |>
ggplot()+
  geom_point(aes(x = Date, y = values, color = variable), alpha = 0.5) +
  geom_vline(xintercept = as.numeric(as.Date("1924-02-15")), linetype = 'dotted') +
  annotate("text", x = as.Date("1924-02-15", format = '%Y-%m-%d'),
  y = 0, label= "Raikoke [1924-02-15]", hjust = 0, vjust = -0.2, angle = 90) +
  labs(x = 'Date [year]', y = 'Transmittance [%]') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))
dev.off()
```

### Mt. Brukkaros

```{r}
Mt.Brukkaros.1926.1930|>
  dplyr::rename('350' = transmission1....100.,
                '400' = transmission2....100.,
                '450' = transmission3....100.,
                '500' = transmission4....100.,
                '600' = transmission5....100.,
                '700' = transmission6....100.,
                '800' = transmission7....100.,
                '1000' = transmission8....100.,
                '1200' = transmission9....100.,
                '1600' = transmission10....100.) |>
  dplyr::mutate(Row = c(1 : length(Date))) |>
  pivot_longer(cols = ends_with('0'),
               names_to = 'variable',
               values_to = 'values')|>
  dplyr::mutate(variable = factor(variable,
                levels = c("350", "400", "450", "500", "600", "700", 
                           "800", "1000", "1200", "1600")))|>
  dplyr::mutate(values = ifelse(values >= 1, values/1000, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values)) |>
ggplot()+
  geom_point(aes(x = Date, y = values, color = variable), alpha = 0.1) +
  labs(x = 'Date [year]', y = 'Transmittance [%]') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))
```

### Mt. Wilson

#### Slice and rebuild

```{r Preparation_Mt.Wilson}

Mt.Wilson_a <- Mt.Wilson.1905.1920|>
  slice(1:121)|>
  dplyr::rename('lambda_400' = 'lambda1...m.', 'lambda_450' = 'lambda2...m.',
                'lambda_500' = 'lambda3...m.', 'lambda_600' = 'lambda4...m.',
                'lambda_700' = 'lambda5...m.','lambda_800' = 'lambda6...m.',
                'lambda_900' = 'lambda7...m.','lambda_1000' = 'lambda8...m.',
                'lambda_1200' = 'lambda9...m.','lambda_1600' = 'lambda10...m.',
                'trans_400' = 'transmission1....100.', 'trans_450' = 'transmission2....100.',
                'trans_500' = 'transmission3....100.','trans_600' = 'transmission4....100.',
                'trans_700' = 'transmission5....100.','trans_800' = 'transmission6....100.',
                'trans_900' = 'transmission7....100.','trans_1000' = 'transmission8....100.',
                'trans_1200' = 'transmission9....100.',
                'trans_1600' = 'transmission10....100.')|>
  dplyr::mutate('lambda_350' = 0.35, 'trans_350' = NA)|>
  dplyr::select(c('row', 'Date','lambda_350', 'trans_350','lambda_400','trans_400',
                  'lambda_450','trans_450', 'lambda_500', 'trans_500', 
                  'lambda_600', 'trans_600', 'lambda_700', 'trans_700', 
                  'lambda_800', 'trans_800', 'lambda_900', 'trans_900', 
                  'lambda_1000', 'trans_1000',
                  'lambda_1200', 'trans_1200', 'lambda_1600', 'trans_1600'))

Mt.Wilson_b <- Mt.Wilson.1905.1920|>
  slice(122:563)|>
    dplyr::rename('lambda_350' = 'lambda1...m.','lambda_400' = 'lambda2...m.',
                'lambda_450' = 'lambda3...m.','lambda_500' = 'lambda4...m.',
                'lambda_600' = 'lambda5...m.','lambda_700' = 'lambda6...m.',
                'lambda_800' = 'lambda7...m.', 'lambda_900' = 'lambda8...m.',
                'lambda_1000' = 'lambda9...m.', 'lambda_1200' = 'lambda10...m.',
                'lambda_1600' = 'lambda11...m.',
                'trans_350' = 'transmission1....100.','trans_400' = 'transmission2....100.',
                'trans_450' = 'transmission3....100.','trans_500' = 'transmission4....100.',
                'trans_600' = 'transmission5....100.','trans_700' = 'transmission6....100.',
                'trans_800' = 'transmission7....100.','trans_900' = 'transmission8....100.',
                'trans_1000' = 'transmission9....100.','trans_1200' = 'transmission10....100.',
                'trans_1600' = 'transmission11....100.')|>
  dplyr::select(c('row', 'Date','lambda_350', 'trans_350','lambda_400','trans_400',
                  'lambda_450','trans_450', 'lambda_500', 'trans_500', 
                  'lambda_600', 'trans_600', 'lambda_700', 'trans_700', 
                  'lambda_800', 'trans_800', 'lambda_900', 'trans_900', 
                  'lambda_1000', 'trans_1000',
                  'lambda_1200', 'trans_1200', 'lambda_1600', 'trans_1600'))

Mt.Wilson_c <- Mt.Wilson.1905.1920|>
  slice(564:1245)|>
  dplyr::rename('lambda_350' = 'lambda1...m.','lambda_400' = 'lambda2...m.',
                'lambda_450' = 'lambda3...m.','lambda_500' = 'lambda4...m.',
                'lambda_600' = 'lambda5...m.','lambda_700' = 'lambda6...m.',
                'lambda_800' = 'lambda7...m.','lambda_1000' = 'lambda8...m.',
                'lambda_1200' = 'lambda9...m.','lambda_1600' = 'lambda10...m.',
                'trans_350' = 'transmission1....100.','trans_400' = 'transmission2....100.',
                'trans_450' = 'transmission3....100.', 'trans_500' = 'transmission4....100.',
                'trans_600' = 'transmission5....100.','trans_700' = 'transmission6....100.',
                'trans_800' = 'transmission7....100.','trans_1000' = 'transmission8....100.',
                'trans_1200' = 'transmission9....100.',
                'trans_1600' = 'transmission10....100.',)|>
  dplyr::mutate('lambda_900' = 0.9, 'trans_900' = NA)|>
  dplyr::select(c('row', 'Date','lambda_350', 'trans_350','lambda_400','trans_400',
                  'lambda_450','trans_450', 'lambda_500', 'trans_500', 'lambda_600', 
                  'trans_600','lambda_700', 'trans_700', 'lambda_800', 'trans_800',
                  'lambda_900', 'trans_900', 'lambda_1000', 'trans_1000',
                  'lambda_1200', 'trans_1200', 'lambda_1600', 'trans_1600'))


Mt.Wilson <- rbind(Mt.Wilson_a, Mt.Wilson_b)

Mt.Wilson <- rbind(Mt.Wilson, Mt.Wilson_c)

Mt.Wilson <- Mt.Wilson|>
  dplyr::mutate(across(3:24, ~ifelse(.x > 2, NA, .x)))|>
  dplyr::filter(trans_1000 > 0.7)
```

#### Dataquality

-   Transform data frame into a long format.

-   Set levels

-   Substitute strange values with NA

```{r}
Mt.Wilson_long <- Mt.Wilson|>
  dplyr::select(c('Date', starts_with('t')))|>
  pivot_longer(cols = starts_with('t'),
               names_to = 'variable',
               values_to = 'values')|>
  dplyr::mutate('lambda' = rep(c('350', '400', '450', '500', '600', '700', 
                                 '800','900', '1000', '1200', '1600'), times = 1238))|>
  dplyr::mutate(variable = factor(variable,
                levels = c("trans_350", "trans_400", "trans_450", "trans_500", 
                           "trans_600", "trans_700", "trans_800", "trans_900",
                           "trans_1000", "trans_1200", "trans_1600")))|>
  dplyr::mutate(values = ifelse(values >= 1, NA, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values))

Mt.Wilson.aplha <- Mt.Wilson|>
  dplyr::mutate(
    alpha_350 = -(log(Mt.Wilson$trans_350) - log(Mt.Wilson$trans_1000)) / log(350),
    alpha_400 = -(log(Mt.Wilson$trans_400) - log(Mt.Wilson$trans_1000)) / log(400),
    alpha_450 = -(log(Mt.Wilson$trans_450) - log(Mt.Wilson$trans_1000)) / log(450),
    alpha_500 = -(log(Mt.Wilson$trans_500) - log(Mt.Wilson$trans_1000)) / log(500),
    alpha_600 = -(log(Mt.Wilson$trans_600) -log(Mt.Wilson$trans_1000)) / log(600),
    alpha_700 = -(log(Mt.Wilson$trans_700) - log(Mt.Wilson$trans_1000)) / log(700),
    alpha_800 = -(log(Mt.Wilson$trans_800) - log(Mt.Wilson$trans_1000)) / log(800),
    alpha_900 = -(log(Mt.Wilson$trans_900) -  log(Mt.Wilson$trans_1000)) / log(900),
    alpha_1200 = -(log(Mt.Wilson$trans_1200) - log(Mt.Wilson$trans_1000)) / log(1200),
    alpha_1600= -(log(Mt.Wilson$trans_1600) - log(Mt.Wilson$trans_1000)) / log(1600))

Mt.Wilson.aplha|>
  dplyr::select(c('row','Date', starts_with('a')))

Mt.Wilson.aplha.long <- Mt.Wilson.aplha|>
  pivot_longer(cols = starts_with('a'),
               names_to = 'variable',
               values_to = 'values')|>
  dplyr::mutate(variable = factor(variable,
                levels = c("alpha_350", "alpha_400", "alpha_450", "alpha_500", 
                           "alpha_600", "alpha_700", "alpha_800", "alpha_900",
                           "alpha_1000", "alpha_1200", "alpha_1600")))
```

#### Visualize Transmission

```{r message=FALSE, warning=FALSE, error=FALSE}

################################################################################
# Overview

Mt.Wilson_long|>
ggplot()+
  geom_point(aes(x = Date, y = values, color = variable), alpha = 0.1) +
  geom_vline(xintercept = as.numeric(as.Date("1907-03-28")), linetype = 'dotted') +
  annotate("text", x = as.Date("1907-03-28", format = '%Y-%m-%d'),
  y = 0, label= "Ksudach [1907-03-28]", hjust = 0, vjust = -0.2, angle = 90) + 
  geom_vline(xintercept = as.numeric(as.Date("1912-06-06")), linetype = 'dotted') +
  annotate("text", x = as.Date("1912-06-06", format = '%Y-%m-%d'),
  y = 0, label= "Katmai [1912-06-06]", hjust = 0, vjust = -0.2, angle = 90) +
  geom_vline(xintercept = as.numeric(as.Date("1918-10-12")), linetype = 'dotted') +
  annotate("text", x = as.Date("1918-10-12", format = '%Y-%m-%d'),
  y = 0, label= "Katla [1918-10-12]", hjust = 0, vjust = -0.2, angle = 90) +  
  labs(x = 'Date [year]', y = 'Transmittance [%]') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))

################################################################################
# Zoom in 
  
Mt.Wilson_long|>
  # Change dates in the filter to zoom into another time period
  dplyr::filter(Date > as_date('1912-01-01') & Date < as_date('1913-01-01')) |>
ggplot()+
  geom_point(aes(x = Date, y = values, color = variable), alpha = 0.75) +
  geom_vline(xintercept = as.numeric(as.Date("1912-06-06")), linetype = 'dotted') +
  # Adapt labels
  annotate("text", x = as.Date("1912-06-06", format = '%Y-%m-%d'),
  y = 0, label= "Katmai [1912-06-06]", hjust = 0, vjust = -0.2, angle = 90) +
  labs(x = 'Months [1912]', y = 'Transmittance [%]') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))


```

#### Boxplot

```{r message=FALSE, warning=FALSE}

Mt.Wilson_long|>
ggplot()+
  geom_boxplot(aes(x = variable, y = values),
  notch = TRUE, outlier.alpha = .1, outlier.colour = 'black') +
  stat_boxplot(aes(x = variable, y = values),
  geom='errorbar', linetype = 1, width = 0.8) +
  geom_jitter(aes(x = variable, y = values), size = .5, width = .1, alpha = .1)+
  labs(x = 'Wavelength [nm]', y = 'Transmittance [%]') +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))

```

#### Optical Depth

```{r warning=FALSE, error=FALSE, message=FALSE}
# optical depth

Mt.Wilson_long|>
  dplyr::mutate_at(c('values'), ~-log(.))|>
  ggplot()+
  geom_point(aes(x = Date, y = values, color = variable), alpha = 0.1) +
  geom_vline(xintercept = as.numeric(as.Date("1912-06-06")), linetype = 'dotted') +
  annotate("text", x = as.Date("1912-06-06", format = '%Y-%m-%d'),
  y = 0, label= "Katmai [1912-06-06]", hjust = -1.6, vjust = -0.2, angle = 90) +
  labs(x = 'Time [1905 - 1920]', y = 'Optical depth') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))

###############################################################################################

Mt.Wilson_long|>
  dplyr::mutate_at(c('values'), ~-log(.))|>
  dplyr::filter(Date > as_date('1912-01-01') & Date < as_date('1913-01-01')) |>
  ggplot()+
  geom_point(aes(x = Date, y = values, color = variable), alpha = 0.5) +
  geom_vline(xintercept = as.numeric(as.Date("1912-06-06")), linetype = 'dotted') +
  annotate("text", x = as.Date("1912-06-06", format = '%Y-%m-%d'),
  y = 0, label= "Katmai [1912-06-06]", hjust = -1.6, vjust = -.2, angle = 90) +
  labs(x = 'Months [1912]', y = 'Optical depth') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))

```

#### Angström Parameter

```{r}
Mt.Wilson.aplha|>
  group_by(month = lubridate::floor_date(Date, 'year'))|>
  dplyr::summarise(mean_350 = mean(trans_350, na.rm = TRUE),
                   mean_400 = mean(trans_400, na.rm = TRUE),
                   mean_450 = mean(trans_450, na.rm = TRUE),
                   mean_500 = mean(trans_500, na.rm = TRUE),
                   mean_600 = mean(trans_600, na.rm = TRUE),
                   mean_700 = mean(trans_700, na.rm = TRUE),
                   mean_800 = mean(trans_800, na.rm = TRUE),
                   mean_900 = mean(trans_900, na.rm = TRUE),
                   mean_1200 = mean(trans_1200, na.rm = TRUE),
                   mean_1600 = mean(trans_1600, na.rm = TRUE))|>
  pivot_longer(cols = starts_with('me'),
               names_to = 'variable',
               values_to = 'values')|>
  dplyr::mutate(variable = factor(variable,
                levels = c("mean_350", "mean_400", "mean_450", "mean_500", 
                           "mean_600", "mean_700", "mean_800", "mean_900",
                           "mean_1000", "mean_1200", "mean_1600")))|>
  ggplot()+
  geom_rect(aes(xmin = as.Date("1912-06-12", format = '%Y-%m-%d'), 
                xmax = as.Date("1914-06-04", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "black", alpha = 0.1, fill = "azure", linewidth = 0.2) +
  geom_rect(aes(xmin = as.Date("1918-01-01", format = '%Y-%m-%d'), 
                xmax = as.Date("1920-03-19", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "black", alpha = 0.1, fill = "azure", linewidth = 0.2) +
  geom_rect(aes(xmin = as.Date("1908-01-01", format = '%Y-%m-%d'), 
                xmax = as.Date("1909-08-09", format = '%Y-%m-%d'), 
                ymin = -Inf, ymax = Inf), 
          color = "black", alpha = 0.1, fill = "azure", linewidth = 0.2) + 
  geom_point(aes(x = month, y = values, color = variable))+
  geom_line(aes(x = month, y = values, color = variable), size = 0.1)+  
  geom_vline(xintercept = as.numeric(as.Date("1912-06-06")), linetype = 'dotted') +
  geom_vline(xintercept = as.numeric(as.Date("1907-03-28")), linetype = 'dotted') +  
  geom_vline(xintercept = as.numeric(as.Date("1918-10-12")), linetype = 'dotted') + 
  annotate("text", x = as.Date("1912-06-06", format = '%Y-%m-%d'),
  y = 0, label= "Katmai [1912-06-06]", hjust = 0, vjust = -0.2, angle = 90) +
  annotate("text", x = as.Date("1907-03-28", format = '%Y-%m-%d'),
  y = 0, label= "Ksudach [1907-03-28]", hjust = 0, vjust = -0.2, angle = 90) +  
  annotate("text", x = as.Date("1918-10-12", format = '%Y-%m-%d'),
  y = 0, label= "Katla [1918-10-12]", hjust = 0, vjust = -0.2, angle = 90) +   
  labs(x = 'Time [1905 - 1920]', y = 'Monthly mean of the Ångström Parameter [ ]') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))

```

```{r warning=FALSE, error=FALSE, message=FALSE}



Mt.Wilson.aplha|>
  group_by(month = lubridate::floor_date(Date, 'month'))|>
  dplyr::summarise(mean_350 = mean(trans_350, na.rm = TRUE),
                   mean_400 = mean(trans_400, na.rm = TRUE),
                   mean_450 = mean(trans_450, na.rm = TRUE),
                   mean_500 = mean(trans_500, na.rm = TRUE),
                   mean_600 = mean(trans_600, na.rm = TRUE),
                   mean_700 = mean(trans_700, na.rm = TRUE),
                   mean_800 = mean(trans_800, na.rm = TRUE),
                   mean_900 = mean(trans_900, na.rm = TRUE),
                   mean_1200 = mean(trans_1200, na.rm = TRUE),
                   mean_1600 = mean(trans_1600, na.rm = TRUE))|>
  pivot_longer(cols = starts_with('me'),
               names_to = 'variable',
               values_to = 'values')|>
  dplyr::mutate(variable = factor(variable,
                levels = c("mean_350", "mean_400", "mean_450", "mean_500", 
                           "mean_600", "mean_700", "mean_800", "mean_900",
                           "mean_1000", "mean_1200", "mean_1600")))|>
  ggplot()+
  geom_point(aes(x = month, y = values, color = variable))+
  geom_line(aes(x = month, y = values, color = variable), size = 0.1)+
  geom_vline(xintercept = as.numeric(as.Date("1912-06-06")), linetype = 'dotted') +
  geom_vline(xintercept = as.numeric(as.Date("1907-03-28")), linetype = 'dotted') +  
  geom_vline(xintercept = as.numeric(as.Date("1918-10-12")), linetype = 'dotted') + 
  annotate("text", x = as.Date("1912-06-06", format = '%Y-%m-%d'),
  y = 0, label= "Katmai [1912-06-06]", hjust = 0, vjust = -0.2, angle = 90) +
  annotate("text", x = as.Date("1907-03-28", format = '%Y-%m-%d'),
  y = 0, label= "Ksudach [1907-03-28]", hjust = 0, vjust = -0.2, angle = 90) +  
  annotate("text", x = as.Date("1918-10-12", format = '%Y-%m-%d'),
  y = 0, label= "Katla [1918-10-12]", hjust = 0, vjust = -0.2, angle = 90) + 
  labs(x = 'Time [1905 - 1920]', 
       y = 'Annual mean of the Ångström Parameter [ ]') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))


Mt.Wilson.aplha|>
  group_by(month = lubridate::floor_date(Date, 'month'))|>
  dplyr::summarise(mean_350 = mean(trans_350, na.rm = TRUE),
                   mean_400 = mean(trans_400, na.rm = TRUE),
                   mean_450 = mean(trans_450, na.rm = TRUE),
                   mean_500 = mean(trans_500, na.rm = TRUE),
                   mean_600 = mean(trans_600, na.rm = TRUE),
                   mean_700 = mean(trans_700, na.rm = TRUE),
                   mean_800 = mean(trans_800, na.rm = TRUE),
                   mean_900 = mean(trans_900, na.rm = TRUE),
                   mean_1200 = mean(trans_1200, na.rm = TRUE),
                   mean_1600 = mean(trans_1600, na.rm = TRUE))|>
  pivot_longer(cols = starts_with('me'),
               names_to = 'variable',
               values_to = 'values')|>
  dplyr::mutate(variable = factor(variable,
                levels = c("mean_350", "mean_400", "mean_450", "mean_500", 
                           "mean_600", "mean_700", "mean_800", "mean_900",
                           "mean_1000", "mean_1200", "mean_1600")))|>
  dplyr::filter(month > as_date('1912-01-01') & month < as_date('1913-01-01')) |>
  ggplot()+
  geom_point(aes(x = month, y = values, color = variable))+
  geom_line(aes(x = month, y = values, color = variable), size = 0.1)+
  geom_vline(xintercept = as.numeric(as.Date("1912-06-06")), linetype = 'dotted') +
  annotate("text", x = as.Date("1912-06-06", format = '%Y-%m-%d'),
  y = 0, label= "Katmai [1912-06-06]", hjust = 0, vjust = -0.2, angle = 90) +
  labs(x = 'Time [1905 - 1920]', 
       y = 'Annual mean of the Ångström Parameter [ ]') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))

test <- Mt.Wilson.aplha|>
  dplyr::summarise(rollmean_350 = rollmean(alpha_350, 12, na.rm = TRUE),
                   rollmean_400 = rollmean(alpha_400, 12, na.rm = TRUE),
                   rollmean_450 = rollmean(alpha_450, 12, na.rm = TRUE),
                   rollmean_500 = rollmean(alpha_500, 12, na.rm = TRUE),
                   rollmean_600 = rollmean(alpha_600, 12, na.rm = TRUE),
                   rollmean_700 = rollmean(alpha_700, 12, na.rm = TRUE),
                   rollmean_800 = rollmean(alpha_800, 12, na.rm = TRUE),
                   rollmean_900 = rollmean(alpha_900, 12, na.rm = TRUE),
                   rollmean_1200 = rollmean(alpha_1200, 12, na.rm = TRUE),
                   rollmean_1600 = rollmean(alpha_1600, 12, na.rm = TRUE))|>
  pivot_longer(cols = starts_with('ro'),
               names_to = 'variable',
               values_to = 'values')|>
  dplyr::mutate(variable = factor(variable,
                levels = c("rollmean_350", "rollmean_400", "rollmean_450", "rollmean_500", 
                           "rollmean_600", "rollmean_700", "rollmean_800", "rollmean_900",
                           "rollmean_1000", "rollmean_1200", "rollmean_1600")))

Mt.Wilson.aplha|>
  group_by(month = lubridate::floor_date(Date, 'day'))|>
  dplyr::summarise(mean_350 = mean(trans_350, na.rm = TRUE),
                   mean_400 = mean(trans_400, na.rm = TRUE),
                   mean_450 = mean(trans_450, na.rm = TRUE),
                   mean_500 = mean(trans_500, na.rm = TRUE),
                   mean_600 = mean(trans_600, na.rm = TRUE),
                   mean_700 = mean(trans_700, na.rm = TRUE),
                   mean_800 = mean(trans_800, na.rm = TRUE),
                   mean_900 = mean(trans_900, na.rm = TRUE),
                   mean_1200 = mean(trans_1200, na.rm = TRUE),
                   mean_1600 = mean(trans_1600, na.rm = TRUE))|>
  pivot_longer(cols = starts_with('me'),
               names_to = 'variable',
               values_to = 'values')|>
  dplyr::mutate(variable = factor(variable,
                levels = c("mean_350", "mean_400", "mean_450", "mean_500", 
                           "mean_600", "mean_700", "mean_800", "mean_900",
                           "mean_1000", "mean_1200", "mean_1600")))|>
  group_by(variable)|>
  dplyr::mutate(rolling_mean = rollmean(values, 5, fill = NA))|>
  dplyr::filter(month > as_date('1912-05-01') & month < as_date('1913-01-01')) |>
  ggplot(aes(x = month, y = rolling_mean, color = variable)) +
  geom_point(aes(y = values, color = variable)) +
  geom_line(aes(y = values, color = variable), size = 0.1) +
  geom_line(aes(y = rolling_mean, color = variable), size = 1) +
  geom_vline(xintercept = as.numeric(as.Date("1912-06-06")), linetype = 'dotted') +
  annotate("text", x = as.Date("1912-06-06", format = '%Y-%m-%d'),
  y = 0, label= "Katmai [1912-06-06]", hjust = 0, vjust = -0.2, angle = 90) +
  labs(x = 'Time [1905 - 1920]', 
       y = 'Annual mean of the Ångström Parameter [ ]') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))

```

#### PDFs

```{r}
################################################################################
# PDFs

pdf('../analysis/Mt.Wilson.1905.1920.pdf',
    width = 8, height = 5)

dev.off()

pdf('../analysis/Mt.Wilson.1912.katmai.pdf',
    width = 8, height = 5)

dev.off()

pdf('../analysis/Boxplot_Mt.Wilson.pdf',
    width = 8, height = 5)
dev.off

pdf('../analysis/Mt.Wilson.od.1905.1920.pdf',
    width = 8, height = 5)
dev.off()

pdf('../analysis/Mt.Wilson.od.1912.pdf',
    width = 8, height = 5)
```

```         
```

### Table Mountain

```{r}
Table.mountain.1925.1930|>
  dplyr::rename('400' = transmission1....100.,
                '450' = transmission2....100.,
                '500' = transmission3....100.,
                '600' = transmission4....100.,
                '700' = transmission5....100.,
                '800' = transmission6....100.,
                '900' = transmission7....100.,
                '1000' = transmission8....100.,
                '1200' = transmission9....100.,
                '1600' = transmission10....100.) |>
  dplyr::select(ends_with('0'), Date)|>
  pivot_longer(cols = ends_with('0'),
               names_to = 'variable',
               values_to = 'values')|>
dplyr::mutate(variable = factor(variable,
                                levels = c("400", "450", "500", "600", "700",
                                      "800", "900", "1000", "1200", "1600")))|>
  dplyr::mutate(values = ifelse(values >= 1, values/1000, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values)) |>
  drop_na()|>
  ggplot()+
  geom_point(aes(x = Date, y = values, color = variable)) +
  geom_vline(xintercept = as.numeric(as.Date("1924-02-15")), linetype = 'dotted') +
  annotate("text", x = as.Date("1924-02-15", format = '%Y-%m-%d'),
  y = 0, label= "Raikoke [1924-02-15]", hjust = 0, vjust = -0.2, angle = 90) +
  labs(x = 'Date', y = 'Transmittance [%]') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))



Table.mountain.1925.1930|>
  dplyr::rename('400' = transmission1....100.,
                '450' = transmission2....100.,
                '500' = transmission3....100.,
                '600' = transmission4....100.,
                '700' = transmission5....100.,
                '800' = transmission6....100.,
                '900' = transmission7....100.,
                '1000' = transmission8....100.,
                '1200' = transmission9....100.,
                '1600' = transmission10....100.) |>
  dplyr::select(ends_with('0'), Date)|>
  dplyr::mutate_at(c('400', '450', '500', '600', '700', 
                     '800','900', '1000', '1200', '1600'), ~-log(.))|>
  pivot_longer(cols = ends_with('0'),
               names_to = 'variable',
               values_to = 'values')|>
dplyr::mutate(variable = factor(variable,
                                levels = c("400", "450", "500", "600", "700",
                                      "800", "900", "1000", "1200", "1600")))|>
  dplyr::mutate(values = ifelse(values >= 1, values/1000, values)) |>
  dplyr::mutate(values = ifelse(values <= 0.1, NA, values)) |>
  drop_na()|>
  ggplot()+
  geom_point(aes(x = Date, y = values, color = variable)) +
  geom_vline(xintercept = as.numeric(as.Date("1924-02-15")), linetype = 'dotted') +
  annotate("text", x = as.Date("1924-02-15", format = '%Y-%m-%d'),
  y = 0, label= "Raikoke [1924-02-15]", hjust = 0, vjust = -0.2, angle = 90) +
  labs(x = 'Date', y = 'Optical depth') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))


Table.mountain.1925.1930|>
  dplyr::rename('400' = transmission1....100.,
                '450' = transmission2....100.,
                '500' = transmission3....100.,
                '600' = transmission4....100.,
                '700' = transmission5....100.,
                '800' = transmission6....100.,
                '900' = transmission7....100.,
                '1000' = transmission8....100.,
                '1200' = transmission9....100.,
                '1600' = transmission10....100.) |>
  dplyr::select(ends_with('0'), Date)|>
  dplyr::mutate_at(c('400', '450', '500', '600', '700', 
                     '800','900', '1000', '1200', '1600'), ~-log(.))|>
  dplyr::mutate(alpha = - (log(Table.mountain.1925.1930$transmission1....100.) / log(Table.mountain.1925.1930$transmission10....100.))/log(350)/log(1600))|>
  ggplot()+
  geom_line(aes(x = Date, y = alpha))+
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))
```

### Washington

```{r}
pdf('../analysis/washington.1902.1907.pdf',
    width = 8, height = 5)
Washington.1902.1904|>
  dplyr::rename('400' = transmission1....100.,
                '450' = transmission2....100.,
                '500' = transmission3....100.,
                '600' = transmission4....100.,
                '700' = transmission5....100.,
                '800' = transmission6....100.,
                '900' = transmission7....100.,
                '1000' = transmission8....100.,
                '1200' = transmission9....100.,
                '1600' = transmission10....100.) |>
  dplyr::select(ends_with('0'), Date)|>
  pivot_longer(cols = ends_with('0'),
               names_to = 'variable',
               values_to = 'values')|>
  dplyr::mutate(variable = factor(variable,
                                levels = c("400", "450", "500", "600", "700",
                                      "800", "900", "1000", "1200", "1600")))|>
  drop_na()|>
  ggplot()+
  geom_point(aes(x = Date, y = values, color = variable)) +
  geom_vline(xintercept = as.numeric(as.Date("1902-10-26")), linetype = 'dotted') +
  annotate("text", x = as.Date("1902-10-26", format = '%Y-%m-%d'),
  y = 0, label= "Santa Maria [1902-10-26]", hjust = 0, vjust = -0.2, angle = 90) +
  geom_vline(xintercept = as.numeric(as.Date("1907-03-28")), linetype = 'dotted') +
    annotate("text", x = as.Date("1907-03-28", format = '%Y-%m-%d'),
  y = 0, label= "Ksudach [1907-03-28]", hjust = 0, vjust = -0.2, angle = 90) +
  labs(x = 'Date', y = 'Transmittance [%]') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))
dev.off()
###############################################################################################
pdf('../analysis/washington.1902.santamaria.pdf',
    width = 8, height = 5)
Washington.1902.1904|>
  dplyr::rename('400' = transmission1....100.,
                '450' = transmission2....100.,
                '500' = transmission3....100.,
                '600' = transmission4....100.,
                '700' = transmission5....100.,
                '800' = transmission6....100.,
                '900' = transmission7....100.,
                '1000' = transmission8....100.,
                '1200' = transmission9....100.,
                '1600' = transmission10....100.) |>
  dplyr::select(ends_with('0'), Date)|>
  pivot_longer(cols = ends_with('0'),
               names_to = 'variable',
               values_to = 'values')|>
  dplyr::mutate(variable = factor(variable,
                                levels = c("400", "450", "500", "600", "700",
                                      "800", "900", "1000", "1200", "1600")))|>
  dplyr::filter(Date > as_date('1902-01-01') & Date < as_date('1904-01-01')) |>
  drop_na()|>
  ggplot()+
  geom_point(aes(x = Date, y = values, color = variable)) +
  geom_vline(xintercept = as.numeric(as.Date("1902-10-26")), linetype = 'dotted') +
  annotate("text", x = as.Date("1902-10-26", format = '%Y-%m-%d'),
  y = 0, label= "Santa Maria [1902-10-26]", hjust = 0, vjust = -0.2, angle = 90) +
  labs(x = 'Date', y = 'Transmittance [%]') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))
dev.off()
```

## 

```{r}
pdf('../analysis/washington.od.1902.1907.pdf',
    width = 8, height = 5)
Washington.1902.1904|>
  dplyr::rename('400' = transmission1....100.,
                '450' = transmission2....100.,
                '500' = transmission3....100.,
                '600' = transmission4....100.,
                '700' = transmission5....100.,
                '800' = transmission6....100.,
                '900' = transmission7....100.,
                '1000' = transmission8....100.,
                '1200' = transmission9....100.,
                '1600' = transmission10....100.) |>
  dplyr::select(ends_with('0'), Date)|>
  dplyr::mutate_at(c('400', '450', '500', '600', '700', 
                     '800','900', '1000', '1200', '1600'), ~-log(.))|>
  pivot_longer(cols = ends_with('0'),
               names_to = 'variable',
               values_to = 'values')|>
  dplyr::mutate(variable = factor(variable,
                                levels = c("400", "450", "500", "600", "700",
                                      "800", "900", "1000", "1200", "1600")))|>
  drop_na()|>
  ggplot()+
  geom_point(aes(x = Date, y = values, color = variable)) +
  geom_vline(xintercept = as.numeric(as.Date("1902-10-26")), linetype = 'dotted') +
  annotate("text", x = as.Date("1902-10-26", format = '%Y-%m-%d'),
  y = 0, label= "Santa Maria [1902-10-26]", hjust = -1, vjust = -0.2, angle = 90) +
  geom_vline(xintercept = as.numeric(as.Date("1907-03-28")), linetype = 'dotted') +
    annotate("text", x = as.Date("1907-03-28", format = '%Y-%m-%d'),
  y = 0, label= "Ksudach [1907-03-28]", hjust = -1, vjust = -0.2, angle = 90) +
  labs(x = 'Date [1902 - 1907]', y = 'Optical depth') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))
dev.off()
###############################################################################################
pdf('../analysis/washington.od.1902.pdf',
    width = 8, height = 5)
Washington.1902.1904|>
  dplyr::rename('400' = transmission1....100.,
                '450' = transmission2....100.,
                '500' = transmission3....100.,
                '600' = transmission4....100.,
                '700' = transmission5....100.,
                '800' = transmission6....100.,
                '900' = transmission7....100.,
                '1000' = transmission8....100.,
                '1200' = transmission9....100.,
                '1600' = transmission10....100.) |>
  dplyr::select(ends_with('0'), Date)|>
  dplyr::mutate_at(c('400', '450', '500', '600', '700', 
                     '800','900', '1000', '1200', '1600'), ~-log(.))|>
  pivot_longer(cols = ends_with('0'),
               names_to = 'variable',
               values_to = 'values')|>
  dplyr::mutate(variable = factor(variable,
                                levels = c("400", "450", "500", "600", "700",
                                      "800", "900", "1000", "1200", "1600")))|>
  dplyr::filter(Date > as_date('1902-01-01') & Date < as_date('1904-01-01')) |>
  drop_na()|>
  ggplot()+
  geom_point(aes(x = Date, y = values, color = variable)) +
  geom_vline(xintercept = as.numeric(as.Date("1902-10-26")), linetype = 'dotted') +
  annotate("text", x = as.Date("1902-10-26", format = '%Y-%m-%d'),
  y = 0, label= "Santa Maria [1902-10-26]", hjust = -1, vjust = -0.2, angle = 90) +
  labs(x = 'Months [1902 - 1903]', y = 'Optical depth') +
  scale_color_viridis_d(option = "magma",
  guide = guide_legend(override.aes = list(size = 3,
  alpha = 1), title = "Wavelength [nm]")) +
  theme_light() +
  theme(panel.border = element_rect(colour = "black", fill = NA, linewidth = 1))
dev.off()
```
